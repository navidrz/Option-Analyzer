**ุดุฑูุน**

ูุฑ ุงุฏูโ ุจุฒุฑฺฏ ุงุฒ ุฌุฑููโุง ฺฉูฺฺฉ ุขุบุงุฒ ูโุดูุฏุ ู ุงู ูุฏูู ูุฒ ุงุฒ ููู ุจุงูุฑ ุจุฑุฎุงุณุชู ุงุณุชุ ุชูุงุด ุจุฑุง ูพููุฏ ูุงู ุฏูุง ูพุฑฺุงูุด ุงุฎุชุงุฑ ูุนุงูููโูุง ู ูุฏุฑุช ุจโุจุฏู ุชุญูู ุฏุงุฏูโูุง. ุฏุฑ ุทุฑุงุญ ุงู ุงุจุฒุงุฑุ ุฏุบุฏุบูโ ุงุตู ูู ุงู ุจูุฏ ฺฉู ุจุง ุจูุฑูโฺฏุฑ ุงุฒ ุฏุงูุด ุฑูุฒ ูุงู ู ูุงุจูุชโูุง ููุงูุฑุ ุงุจุฒุงุฑ ูุฑุงูู ฺฉูู ฺฉู ููโุชููุง ูุฑุฒูุง ุชุญูู ุฑุง ฺฏุณุชุฑุด ุฏูุฏุ ุจูฺฉู ฺฉุงุฑุจุฑุฏุ ุฏููุ ู ุจูโุฑูุฒ ุจุงุดุฏ. ุงู ูุฏููุ ุงุฒ ุงุจุชุฏุง ุชุง ุงูุชูุงุ ุฏุงุณุชุงู ุงุฒ ุชููู ุฏุงูุด ูุงู ู ุจุฑูุงููโููุณ ุงุณุชุ ูุตูโุง ุงุฒ ุฌุณุชโูุฌู ุจุฑุง ุฏุฑฺฉ ุจูุชุฑ ุจุงุฒุงุฑ ู ุจูููโุณุงุฒ ุชุตููโฺฏุฑโูุง ุณุฑูุงูโฺฏุฐุงุฑ.

---

## ๐ **ูุฏูู ุชุญูู ุงุฎุชุงุฑ ูุนุงููู**

ุงู ูุฏูู ุจูโููุธูุฑ ุชุญูู ู ุงุฑุฒุงุจ **ุงุฎุชุงุฑ ูุนุงููู** ุงุฒ ุทุฑู ุดุจูโุณุงุฒ ูููุช ฺฉุงุฑูู ู ูุญุงุณุจู ุดุงุฎุตโูุง ูุงู ูุฎุชูู ุทุฑุงุญ ุดุฏู ุงุณุช. ุฏุฑ ุงุฏุงููุ ุจู ุจุฑุฑุณ ุจุฎุดโูุง ูุฎุชูู ุงู ฺฉุฏ ูโูพุฑุฏุงุฒู. 


### ๐ **ูุงุฑุฏ ฺฉุฑุฏู ฺฉุชุงุจุฎุงููโูุง ููุฑุฏ ูุงุฒ**

```python
import numpy as np
import pandas as pd
import multiprocessing
from typing import Dict, Tuple, Optional, Any
from scipy.stats import norm, skew, kurtosis, skewnorm
from scipy.optimize import minimize
from functools import partial
import logging
from gldpy import GLD  # ุงุทููุงู ุงุฒ ูุตุจ ู ูุงุฑุฏ ฺฉุฑุฏู ุตุญุญ gldpy
import matplotlib.pyplot as plt
```

**ุชูุถุญุงุช:**

- **`numpy` ู `pandas`**: ุจุฑุง ูพุฑุฏุงุฒุด ุฏุงุฏูโูุง ุนุฏุฏ ู ุฌุฏูู.
- **`multiprocessing`**: ุจุฑุง ุงุฌุฑุง ููุงุฒ ุดุจูโุณุงุฒโูุง ู ุงูุฒุงุด ฺฉุงุฑุง.
- **`scipy.stats`**: ุจุฑุง ุชูุฒุนโูุง ุขูุงุฑ ูุฎุชูู.
- **`logging`**: ุจุฑุง ุซุจุช ูุงฺฏโูุง ู ูพฺฏุฑ ูุฑุขูุฏูุง.
- **`gldpy`**: ุจุฑุง ุชุทุจู ุชูุฒุนโูุง ุนููู (GLD).
- **`matplotlib.pyplot`**: ุจุฑุง ุชุฑุณู ูููุฏุงุฑูุง.

### ๐ **ูพฺฉุฑุจูุฏ ูุงฺฏูฺฏ**

```python
# ูพฺฉุฑุจูุฏ ูุงฺฏุฑ
logger = logging.getLogger("OptionAnalysisLogger")
logger.setLevel(logging.DEBUG)  # ุชูุธู ุณุทุญ ูุงฺฏูฺฏ ุจู DEBUG ุจุฑุง ุซุจุช ุฏููโุชุฑ
handler = logging.StreamHandler()
formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
handler.setFormatter(formatter)
logger.addHandler(handler)
```

**ุชูุถุญุงุช:**

- **ุชุนุฑู ฺฉ Logger**: ุจุง ูุงู `"OptionAnalysisLogger"` ุจุฑุง ุซุจุช ูุงฺฏโูุง.
- **ุณุทุญ ูุงฺฏูฺฏ**: ุชูุธู ุดุฏู ุจู `DEBUG` ุจุฑุง ุฏุฑุงูุช ุชูุงู ุฌุฒุฆุงุช.
- **Handler ู Formatter**: ุจุฑุง ุงุฑุณุงู ูุงฺฏโูุง ุจู ุฎุฑูุฌ ุงุณุชุงูุฏุงุฑุฏ ุจุง ูุงูุจ ูุดุฎุต.

### ๐ **ุชุนุฑู ุณูุงุฑููุง ุจุงุฒุงุฑ**

```python
# ุชุนุฑู ุณูุงุฑููุง ุจุงุฒุงุฑ
MARKET_SCENARIOS = {
    'ุจุงุฒุงุฑ ุนุงุฏ': {'skewness': 0.0, 'kurtosis': 3.0},
    'ุจุงุฒุงุฑ ุตุนูุฏ': {'skewness': -0.5, 'kurtosis': 3.5},
    'ุจุงุฒุงุฑ ูุฒูู': {'skewness': 0.5, 'kurtosis': 3.5},
    'ุจุงุฒุงุฑ ูพุฑููุณุงู': {'skewness': 0.0, 'kurtosis': 5.0},
    'ุณููุท ุจุงุฒุงุฑ': {'skewness': 2.0, 'kurtosis': 9.0},
    'ุฑุงู ุจุงุฒุงุฑ': {'skewness': -2.0, 'kurtosis': 9.0}
}
```

**ุชูุถุญุงุช:**

- **`skewness` (ฺููฺฏ)**: ุนุฏู ุชูุงุฑู ุชูุฒุน ุฏุงุฏูโูุง.
- **`kurtosis` (ฺฉุดุฏฺฏ)**: ฺฉุดุฏฺฏ ุชูุฒุน ูุณุจุช ุจู ุชูุฒุน ูุฑูุงู.

---

## ๐๏ธ **ฺฉูุงุณ `OptionAnalyzer`**

ุงู ฺฉูุงุณ ูุณุชู ุงุตู ุชุญูู **ุงุฎุชุงุฑ ูุนุงููู** ุฑุง ุชุดฺฉู ูโุฏูุฏ ู ุดุงูู ูุชุฏูุง ูุฎุชูู ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุงุ ุดุจูโุณุงุฒ ููุชโูุงุ ูุญุงุณุจู ุดุงุฎุตโูุง ูุงู ู ุงุฑุงุฆู ุชูุตูโูุง ุงุณุช.

### ๐ง **ุชุนุฑู ฺฉูุงุณ ู ูุชุฏ ุณุงุฒูุฏู**

```python
class OptionAnalyzer:
    def __init__(self,
                 data_loader,  # ูููููโุง ุงุฒ ฺฉูุงุณ DataLoader
                 risk_free_rate: float = 0.01,
                 market_scenario: str = 'ุจุงุฒุงุฑ ุนุงุฏ',
                 distribution_type: str = 'GLD'):
        """
        ููุฏุงุฑุฏู ุงููู OptionAnalyzer ุจุง ุงุณุชูุงุฏู ุงุฒ DataLoader ู ูพุงุฑุงูุชุฑูุง ุชุญูู.
        
        Args:
            data_loader: ูููููโุง ุงุฒ ฺฉูุงุณ DataLoader.
            risk_free_rate (float): ูุฑุฎ ุจูุฑู ุจุฏูู ุฑุณฺฉ.
            market_scenario (str): ุณูุงุฑู ุจุงุฒุงุฑ ุจุฑุง ุดุจูโุณุงุฒ.
            distribution_type (str): ููุน ุชูุฒุน ุจุฑุง ุดุจูโุณุงุฒ ููุชโูุง ('GLD', 'SkewNormal', 'CornishFisher', ู ุบุฑู).
        """
        self.data_loader = data_loader
        self.risk_free_rate = risk_free_rate
        self.market_scenario = market_scenario
        self.distribution_type = distribution_type
        self.cleaned_data = pd.DataFrame()
        self.historical_data = {}
        self.simulation_results = {}
        self.greeks = {}
        self.pop_results = {}
        self.breakeven_points = {}
        self.sharpe_ratios = {}
        self.var = {}
        self.cvar = {}
        self.recommendations_df = pd.DataFrame()
        self.target_date_distribution = {}
        self.cash_flows = {}
        self.variance = {}
        self.payout_ratios = {}
        self.market_views = {}
        self.strategy = 'default'
        self.metrics_min = {}
        self.metrics_max = {}
        self.thresholds = {}
        self.scenario_analysis_results = {}
        self.market_scenarios = MARKET_SCENARIOS
```

**ุชูุถุญุงุช:**

- **ูพุงุฑุงูุชุฑูุง ูุฑูุฏ**:
  - **`data_loader`**: ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ู ูพุฑุฏุงุฒุด ุฏุงุฏูโูุง ุงููู.
  - **`risk_free_rate`**: ูุฑุฎ ุจูุฑู ุจุฏูู ุฑุณฺฉ.
  - **`market_scenario`**: ุณูุงุฑู ุจุงุฒุงุฑ ุงูุชุฎุงุจโุดุฏู.
  - **`distribution_type`**: ููุน ุชูุฒุน ููุฑุฏ ุงุณุชูุงุฏู ุจุฑุง ุดุจูโุณุงุฒ ููุชโูุง.
  
- **ูุชุบุฑูุง ุฏุงุฎู**: ุดุงูู ุฏุงุฏูโูุง ูพุงฺฉโุดุฏูุ ุฏุงุฏูโูุง ุชุงุฑุฎุ ูุชุงุฌ ุดุจูโุณุงุฒุ ุดุงุฎุตโูุง ููุงูุ ู ุณุงุฑ ุดุงุฎุตโูุง ูุงู.

### ๐ฆ **ูุชุฏ `prepare_data`**

```python
def prepare_data(self):
    """
    ุขูุงุฏูโุณุงุฒ ุฏุงุฏูโูุง ุจุง ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง ูพุงฺฉโุดุฏู ู ุชุงุฑุฎ ุงุฒ DataLoader.
    """
    try:
        # ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง ุจุง ุงุณุชูุงุฏู ุงุฒ DataLoader
        self.cleaned_data, self.historical_data = self.data_loader.load_all_data()
        logger.info("ุขูุงุฏูโุณุงุฒ ุฏุงุฏูโูุง ุชฺฉูู ุดุฏ.")
        
        # ูุญุงุณุจู ุดุงุฎุตโูุง ุงุถุงู
        self.calculate_volatility()
        self.calculate_moneyness()
    except Exception as e:
        logger.error(f"ุขูุงุฏูโุณุงุฒ ุฏุงุฏูโูุง ุดฺฉุณุช ุฎูุฑุฏ: {e}")
        raise
```

**ุชูุถุญุงุช:**

- **ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง**: ุจุง ุงุณุชูุงุฏู ุงุฒ `DataLoader`, ุฏุงุฏูโูุง ูพุงฺฉโุดุฏู ู ุชุงุฑุฎ ุจุงุฑฺฏุฐุงุฑ ูโุดููุฏ.
- **ูุญุงุณุจู ุดุงุฎุตโูุง ุงุถุงู**: ููุณุงู (`Volatility`) ู ูููโููุณ (`Moneyness`) ูุญุงุณุจู ูโุดููุฏ.

### ๐ **ูุชุฏ `calculate_volatility`**

```python
def calculate_volatility(self):
    """
    ูุญุงุณุจู ููุณุงู ุชุงุฑุฎ ุจุฑุง ูุฑ ฺฉุฏ ูุนุงููู ููุญุตุฑ ุจู ูุฑุฏ.
    """
    logger.info("ูุญุงุณุจู ููุณุงู ุชุงุฑุฎ ุจุฑุง ูุฑ ฺฉุฏ ูุนุงููู.")
    volatility_dict = {}
    for ua_tse_code, df in self.historical_data.items():
        if df.empty:
            logger.warning(f"ุฏุงุฏูโูุง ุชุงุฑุฎ ุจุฑุง ฺฉุฏ ูุนุงููู {ua_tse_code} ููุฌูุฏ ูุณุช.")
            volatility_dict[ua_tse_code] = np.nan
            continue
        df = df.sort_values('date')
        df['daily_return'] = df['close'].pct_change()
        daily_std = df['daily_return'].std()
        annual_volatility = daily_std * np.sqrt(252)
        volatility_dict[ua_tse_code] = annual_volatility
        logger.debug(f"ููุณุงู ุจุฑุง {ua_tse_code}: {annual_volatility:.4f}")
    
    self.cleaned_data['Volatility'] = self.cleaned_data['ua_tse_code'].map(volatility_dict)
    missing_vol = self.cleaned_data['Volatility'].isna().sum()
    if missing_vol > 0:
        mean_vol = self.cleaned_data['Volatility'].mean()
        self.cleaned_data['Volatility'].fillna(mean_vol, inplace=True)
        logger.warning(f"ููุณุงูโูุง ูุงูุต ุจุง ูุงูฺฏู ููุณุงู ุชฺฉูู ุดุฏูุฏ: {mean_vol:.4f}")
```

**ูุญุงุณุจู ุจุงุฒุฏู ุฑูุฒุงูู:**

ุจุงุฒุฏู ุฑูุฒุงูู = (ููุช ูพุงุงู ุงูุฑูุฒ - ููุช ูพุงุงู ุฏุฑูุฒ) / ููุช ูพุงุงู ุฏุฑูุฒ

**ุชูุณุฑ:**

ุงู ูุฑููู ุฏุฑุตุฏ ุชุบุฑุงุช ููุช ฺฉ ุฏุงุฑุง (ูุงููุฏ ุณูุงู) ุฑุง ุงุฒ ฺฉ ุฑูุฒ ุจู ุฑูุฒ ุฏฺฏุฑ ูุดุงู ูโุฏูุฏ. ุจู ุนุจุงุฑุช ุฏฺฏุฑุ ูุดุงู ูโุฏูุฏ ฺฉู ููุช ุฏุงุฑุง ุฏุฑ ุทูู ฺฉ ุฑูุฒ ฺู ููุฏุงุฑ ุงูุฒุงุด ุง ฺฉุงูุด ุงูุชู ุงุณุช.

- **ููุช ูพุงุงู ุงูุฑูุฒ**: ููุช ููุง ุฏุงุฑุง ุฏุฑ ูพุงุงู ุฑูุฒ ููุฑุฏ ูุธุฑ
- **ููุช ูพุงุงู ุฏุฑูุฒ**: ููุช ููุง ุฏุงุฑุง ุฏุฑ ูพุงุงู ุฑูุฒ ูุจู

**ูุญุงุณุจู ููุณุงู ุณุงูุงูู:**

ููุณุงู ุณุงูุงูู = ููุณุงู ุฑูุฒุงูู ร โ252

**ุชูุณุฑ:**

ุงู ูุฑููู ุจุฑุง ุชุจุฏู ููุณุงู ุฑูุฒุงูู ฺฉ ุฏุงุฑุง ุจู ููุณุงู ุณุงูุงูู ุงุณุชูุงุฏู ูโุดูุฏ. ุนุฏุฏ 252 ูุดุงูโุฏููุฏู ุชุนุฏุงุฏ ุฑูุฒูุง ูุนุงููุงุช ุชูุฑุจ ุฏุฑ ฺฉ ุณุงู ุงุณุช.

- **ููุณุงู ุณุงูุงูู**: ุงูุฏุงุฒูโฺฏุฑ ูุฒุงู ููุณุงูุงุช ููุช ฺฉ ุฏุงุฑุง ุฏุฑ ุทูู ฺฉ ุณุงู
- **ููุณุงู ุฑูุฒุงูู**: ุงูุฏุงุฒูโฺฏุฑ ูุฒุงู ููุณุงูุงุช ููุช ฺฉ ุฏุงุฑุง ุฏุฑ ุทูู ฺฉ ุฑูุฒ

**ฺุฑุง ุงุฒ โ252 ุงุณุชูุงุฏู ูโฺฉููุ**

ุงุฒ ุขูุฌุง ฺฉู ุจุงุฒุฏูโูุง ุฑูุฒุงูู ูุนูููุงู ุจุง ูู ููุจุณุชฺฏ ฺฉู ุฏุงุฑูุฏุ ูโุชูุงูู ุงุฒ ูฺฺฏโูุง ุฑุงุถ ุจุฑุง ุชุจุฏู ููุณุงู ุฑูุฒุงูู ุจู ููุณุงู ุณุงูุงูู ุงุณุชูุงุฏู ฺฉูู. ุฑุดู ุฏูู ุชุนุฏุงุฏ ุฑูุฒูุง ูุนุงููุงุช ุฏุฑ ุณุงู (โ252) ฺฉ ุชูุฑุจ ูุนููู ุจุฑุง ุงู ุชุจุฏู ุงุณุช.

**ูุฏุฑุช ุฏุงุฏูโูุง ูุงูุต:**

ุงฺฏุฑ ุจุฑุง ุจุฑุฎ ุงุฒ ฺฉุฏูุง ูุนุงูููุ ููุณุงู ูุญุงุณุจู ูุดูุฏ (ูุซูุงู ุจู ุฏูู ูุจูุฏ ุฏุงุฏู ฺฉุงู)ุ ุจู ุฌุง ุขู ุงุฒ ูุงูฺฏู ููุณุงู ฺฉู ุงุณุชูุงุฏู ูโุดูุฏ. ุงู ฺฉุงุฑ ุจู ุงู ุฏูู ุงูุฌุงู ูโุดูุฏ ฺฉู ุงุฒ ุฏุณุช ุฏุงุฏู ุงุทูุงุนุงุช ุจุฑุง ุจุฑุฎ ฺฉุฏูุง ูุนุงูููุ ุจุงุนุซ ฺฉุงูุด ุฏูุช ุชุญูู ฺฉู ูุดูุฏ. ุจุง ุงุณุชูุงุฏู ุงุฒ ูุงูฺฏูุ ฺฉ ุชุฎูู ูุญุงูุธูโฺฉุงุฑุงูู ุงุฒ ููุณุงู ุจุฑุง ุขู ฺฉุฏูุง ูุนุงููู ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดูุฏ.

### ๐ **ูุชุฏ `calculate_moneyness`**

```python
def calculate_moneyness(self):
    """
    ูุญุงุณุจู ูููโููุณ ุจุฑ ุงุณุงุณ ููุน ุงุฎุชุงุฑ ูุนุงููู.
    """
    logger.info("ูุญุงุณุจู ูููโููุณ ุจุฑ ุงุณุงุณ ููุน ุงุฎุชุงุฑ ูุนุงููู.")
    self.cleaned_data['moneyness'] = np.where(
        self.cleaned_data['option_type'].str.upper() == 'CALL',
        self.cleaned_data['last_spot_price'] / self.cleaned_data['strike_price'],
        self.cleaned_data['strike_price'] / self.cleaned_data['last_spot_price']
    )
```

**ุชูุถุญุงุช:**

**ููููู ูููโููุณ:**

ูููโููุณ ุฏุฑ ุจุงุฒุงุฑูุง ูุงูุ ุจู ูฺู ุฏุฑ ุญูุฒู ุงุฎุชุงุฑ ูุนุงูููุ ุจู ุฑุงุจุทู ุจู ููุช ูุนู ฺฉ ุฏุงุฑุง ูพุงู (ูุงููุฏ ุณูุงูุ ฺฉุงูุงุ ุงุฑุฒ ู ...) ู ููุช ุงุฌุฑุง ฺฉ ุงุฎุชุงุฑ ูุนุงููู ุงุดุงุฑู ุฏุงุฑุฏ. ุงู ููููู ุจู ูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง ูุถุนุช ฺฉ ุงุฎุชุงุฑ ูุนุงููู ุฑุง ุงุฒ ูุธุฑ ุณูุฏุขูุฑ ุจุงูููู ุงุฑุฒุงุจ ฺฉูู.

**ูุญุงุณุจู ูููโููุณ:**

ุจุฑุง **ุงุฎุชุงุฑ ูุนุงููู ุฎุฑุฏ (Call)**:

ูููโููุณ = ููุช ุฏุงุฑุง ูพุงู / ููุช ุงุฌุฑุง

- ุงฺฏุฑ ููุฏุงุฑ ูููโููุณ ุจุฒุฑฺฏุชุฑ ุงุฒ 1 ุจุงุดุฏุ ุงุฎุชุงุฑ ูุนุงููู "ุฏุฑ ุณูุฏ" (In-the-Money) ุงุณุช. ุจู ุงู ูุนู ฺฉู ุงฺฏุฑ ุงุฎุชุงุฑ ูุนุงููู ุงุนูุงู ุดูุฏุ ุฎุฑุฏุงุฑ ุณูุฏ ุฎูุงูุฏ ฺฉุฑุฏ.
- ุงฺฏุฑ ููุฏุงุฑ ูููโููุณ ุจุฑุงุจุฑ ุจุง 1 ุจุงุดุฏุ ุงุฎุชุงุฑ ูุนุงููู "ุฏุฑ ููุทู ุณุฑุจูโุณุฑ" (At-the-Money) ุงุณุช. ุจู ุงู ูุนู ฺฉู ุงฺฏุฑ ุงุฎุชุงุฑ ูุนุงููู ุงุนูุงู ุดูุฏุ ุฎุฑุฏุงุฑ ูู ุณูุฏ ูโฺฉูุฏ ู ูู ุถุฑุฑ ูโฺฉูุฏ.
- ุงฺฏุฑ ููุฏุงุฑ ูููโููุณ ฺฉูุชุฑ ุงุฒ 1 ุจุงุดุฏุ ุงุฎุชุงุฑ ูุนุงููู "ุฎุงุฑุฌ ุงุฒ ุณูุฏ" (Out-of-the-Money) ุงุณุช. ุจู ุงู ูุนู ฺฉู ุงฺฏุฑ ุงุฎุชุงุฑ ูุนุงููู ุงุนูุงู ุดูุฏุ ุฎุฑุฏุงุฑ ุถุฑุฑ ุฎูุงูุฏ ฺฉุฑุฏ.

ุจุฑุง **ุงุฎุชุงุฑ ูุนุงููู ูุฑูุด (Put)**:

ูููโููุณ = ููุช ุงุฌุฑุง / ููุช ุฏุงุฑุง ูพุงู

- ุงฺฏุฑ ููุฏุงุฑ ูููโููุณ ุจุฒุฑฺฏุชุฑ ุงุฒ 1 ุจุงุดุฏุ ุงุฎุชุงุฑ ูุนุงููู "ุฎุงุฑุฌ ุงุฒ ุณูุฏ" (Out-of-the-Money) ุงุณุช.
- ุงฺฏุฑ ููุฏุงุฑ ูููโููุณ ุจุฑุงุจุฑ ุจุง 1 ุจุงุดุฏุ ุงุฎุชุงุฑ ูุนุงููู "ุฏุฑ ููุทู ุณุฑุจูโุณุฑ" (At-the-Money) ุงุณุช.
- ุงฺฏุฑ ููุฏุงุฑ ูููโููุณ ฺฉูุชุฑ ุงุฒ 1 ุจุงุดุฏุ ุงุฎุชุงุฑ ูุนุงููู "ุฏุฑ ุณูุฏ" (In-the-Money) ุงุณุช.

**ุงููุช ูููโููุณ:**

- **ุงุฑุฒุงุจ ุณูุฏุขูุฑ**: ูููโููุณ ุจู ูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง ุจูููู ฺฉ ุงุฎุชุงุฑ ูุนุงููู ฺูุฏุฑ ุจุงูููู ุณูุฏุขูุฑ ุงุณุช.
- **ุงุณุชุฑุงุชฺ ูุนุงููุงุช**: ูุนุงูููโฺฏุฑุงู ุงุฒ ูููโููุณ ุจุฑุง ุทุฑุงุญ ุงุณุชุฑุงุชฺโูุง ูุฎุชูู ูุนุงููุงุช ุงุณุชูุงุฏู ูโฺฉููุฏ.
- **ููุชโฺฏุฐุงุฑ ุงุฎุชุงุฑ ูุนุงููู**: ูููโููุณ ฺฉ ุงุฒ ุนูุงูู ููู ุฏุฑ ูุฏูโูุง ููุชโฺฏุฐุงุฑ ุงุฎุชุงุฑ ูุนุงููู ุงุณุช.

### ๐ฒ **ูุชุฏ `simulate_price`**

```python
def simulate_price(self, S0: float, K: float, r: float, sigma: float, T: float, num_simulations: int,
                  distribution_type: str = 'GLD', skewness: float = 0.0, kurtosis_val: float = 3.0) -> Optional[np.ndarray]:
    """
    ุดุจูโุณุงุฒ ููุช ุขูุฏู ุฏุงุฑุง ูพุงู ุจุง ุงุณุชูุงุฏู ุงุฒ ุชูุฒุน ูุดุฎุต.
    
    Args:
        S0 (float): ููุช ูุนู ุฏุงุฑุง.
        K (float): ููุช ุงุฌุฑุง ุงุฎุชุงุฑ ูุนุงููู.
        r (float): ูุฑุฎ ุจูุฑู ุจุฏูู ุฑุณฺฉ.
        sigma (float): ููุณุงู.
        T (float): ุฒูุงู ุจุงูโูุงูุฏู ุชุง ุณุฑุฑุณุฏ (ุจุฑ ุญุณุจ ุณุงู).
        num_simulations (int): ุชุนุฏุงุฏ ุดุจูโุณุงุฒโูุง.
        distribution_type (str): ููุน ุชูุฒุน ุจุฑุง ุดุจูโุณุงุฒ ('GLD', 'SkewNormal', 'CornishFisher', ู ุบุฑู).
        skewness (float): ฺููฺฏ ููุฑุฏ ูุธุฑ.
        kurtosis_val (float): ฺฉุดุฏฺฏ ููุฑุฏ ูุธุฑ.
    
    Returns:
        Optional[np.ndarray]: ููุชโูุง ุดุจูโุณุงุฒโุดุฏู ุฏุฑ ุฒูุงู ุณุฑุฑุณุฏ.
    """
    try:
        if distribution_type == 'GLD':
            # ุงุณุชูุงุฏู ุงุฒ ุจุงุฒุฏูโูุง ุชุงุฑุฎ ุจุฑุง ุชุทุจู GLD
            # ุจู ุฏูู ูพฺุฏฺฏุ ุงุฒ ุชูุฒุน ูุฑูุงู ุจู ุนููุงู ุฌุงฺฏุฒู ุงุณุชูุงุฏู ูโุดูุฏ
            Z = np.random.normal(0, 1, num_simulations) * sigma * np.sqrt(T)
            logger.debug("ุงุณุชูุงุฏู ุงุฒ ุชูุฒุน ูุฑูุงู ุจู ุนููุงู ุฌุงฺฏุฒู ุจุฑุง GLD.")
        elif distribution_type == 'SkewNormal':
            a = skewness
            Z = skewnorm.rvs(a, size=num_simulations)
            logger.debug(f"ุชููุฏ ูุชุบุฑูุง ุชุตุงุฏู SkewNormal ุจุง ูพุงุฑุงูุชุฑ ฺููฺฏ: a={a}")
        elif distribution_type == 'CornishFisher':
            Z = np.random.normal(0, 1, num_simulations)
            Z = self.cornish_fisher_quantile(Z, skewness, kurtosis_val)
            logger.debug(f"ุชุนุฏู ูุชุบุฑูุง ูุฑูุงู ุจุง ุงุณุชูุงุฏู ุงุฒ ุชูุณุนู ฺฉุฑููุด-ูุดุฑ ุจุง ฺููฺฏ={skewness} ู ฺฉุดุฏฺฏ={kurtosis_val}")
        else:
            # ูพุดโูุฑุถ ุจู ุชูุฒุน ูุฑูุงู
            Z = np.random.normal(0, 1, num_simulations)
            logger.debug("ุชููุฏ ูุชุบุฑูุง ุชุตุงุฏู ูุฑูุงู ุจู ุนููุงู ูพุดโูุฑุถ.")
    
        # ูุฑููู ุญุฑฺฉุช ุจุฑุงูู ููุฏุณ
        drift = (r - 0.5 * sigma**2) * T
        diffusion = Z  # Z ุจูโุทูุฑ ูุณุชูู ููุงุณโุฏู ุดุฏู ุจู sigma * sqrt(T)
        S_T = S0 * np.exp(drift + diffusion)
    
        return S_T
    except Exception as e:
        logger.error(f"ุฎุทุง ุฏุฑ ุดุจูโุณุงุฒ ููุช: {e}")
        return None
```

**ุชูุถุญุงุช:**

**ุฑูุดโูุง ุชูุฒุนโุดุฏู ุจุฑุง ุดุจูโุณุงุฒ:**

ุฏุฑ ุดุจูโุณุงุฒโูุง ูุงูุ ุงูุชุฎุงุจ ุชูุฒุน ููุงุณุจ ุจุฑุง ูุชุบุฑูุง ุชุตุงุฏู ุจุณุงุฑ ููู ุงุณุช. ุฏุฑ ุงู ุจุฎุดุ ฺูุฏ ุฑูุด ุฑุงุฌ ุจุฑุง ุดุจูโุณุงุฒ ูุชุบุฑูุง ุชุตุงุฏู ุจุง ูฺฺฏโูุง ุฎุงุต ูุนุฑู ุดุฏูโุงูุฏ:

1. **GLD (Generalized Lambda Distribution):** ุงู ุชูุฒุน ุจุณุงุฑ ุงูุนุทุงูโูพุฐุฑ ุงุณุช ู ูโุชูุงูุฏ ุทู ูุณุน ุงุฒ ุชูุฒุนโูุง ุงุญุชูุงู ุฑุง ูุฏู ฺฉูุฏ. ุจุง ุงู ุญุงูุ ูพุงุฏูโุณุงุฒ ุขู ูพฺุฏู ุงุณุช ู ุจู ููู ุฏููุ ุฏุฑ ุจุฑุฎ ููุงุฑุฏ ุงุฒ ุชูุฒุน ูุฑูุงู ุจู ุนููุงู ุฌุงฺฏุฒู ุจุฑุง ุขู ุงุณุชูุงุฏู ูโุดูุฏ.
2. **SkewNormal (ุชูุฒุน ูุฑูุงู ฺูู):** ุงู ุชูุฒุนุ ฺฉ ุชุนูู ุงุฒ ุชูุฒุน ูุฑูุงู ุงุณุช ฺฉู ุงูฺฉุงู ูุฏูโุณุงุฒ ฺููฺฏ ุฑุง ูุฑุงูู ูโฺฉูุฏ. ฺููฺฏ ุจู ูุนูุง ุนุฏู ุชูุงุฑู ุชูุฒุน ุงุณุช.
3. **CornishFisher:** ุงู ุฑูุดุ ฺฉ ุชูุณุนู ุจุฑ ุงุณุงุณ ุณุฑ ุชููุฑ ุงุณุช ฺฉู ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ุชุง ุชูุฒุนโูุง ุจุง ฺููฺฏ ู ฺฉุดุฏฺฏ ุฏูุฎูุงู ุฑุง ุงุฌุงุฏ ฺฉูุฏ. ฺฉุดุฏฺฏ ุจู ูุฒุงู ูพูู ุจูุฏู ุง ุจุงุฑฺฉ ุจูุฏู ุฏูโูุง ุชูุฒุน ุงุดุงุฑู ุฏุงุฑุฏ.

**ูุฑููู ุญุฑฺฉุช ุจุฑุงูู ููุฏุณ:**

ุงู ูุฑููู ฺฉ ุงุฒ ูููโุชุฑู ูุฑูููโูุง ุฏุฑ ูุฏูโุณุงุฒ ููุช ุฏุงุฑุงโูุง ุงุณุช ู ุจู ุทูุฑ ฺฏุณุชุฑุฏู ุฏุฑ ูุฏูโุณุงุฒ ููุช ุณูุงู ุงุณุชูุงุฏู ูโุดูุฏ. ุงู ูุฑููู ุจุงู ูโฺฉูุฏ ฺฉู ููุช ฺฉ ุฏุงุฑุง ุฏุฑ ุขูุฏู (S_T) ุจุฑุงุจุฑ ุงุณุช ุจุง ููุช ูุนู ุขู (S_0) ุถุฑุจ ุฏุฑ ฺฉ ุนุงูู ุฑุดุฏ ููุง ฺฉู ุดุงูู ูุฑุฎ ุจุฏูู ุฑุณฺฉ (r)ุ ููุณุงูโูพุฐุฑ (ฯ) ู ฺฉ ูุชุบุฑ ุชุตุงุฏู ุงุณุชุงูุฏุงุฑุฏ ูุฑูุงู (Z) ุงุณุช.

- **S_T:** ููุช ุฏุงุฑุง ุฏุฑ ุฒูุงู T
- **S_0:** ููุช ุงููู ุฏุงุฑุง
- **r:** ูุฑุฎ ุจุฏูู ุฑุณฺฉ
- **ฯ:** ููุณุงูโูพุฐุฑ (ุงูุญุฑุงู ุงุณุชุงูุฏุงุฑุฏ ุจุงุฒุฏูโูุง ูฺฏุงุฑุชู)
- **T:** ุฒูุงู
- **Z:** ูุชุบุฑ ุชุตุงุฏู ุงุณุชุงูุฏุงุฑุฏ ูุฑูุงู

**ูุฏุฑุช ุฎุทุง:**

ุฏุฑ ูุฑุงูุฏ ุดุจูโุณุงุฒุ ููฺฉู ุงุณุช ุฎุทุงูุง ุฑุฎ ุฏูุฏ. ุจุฑุง ูุฏุฑุช ุงู ุฎุทุงูุงุ ูุนูููุงู ููุฏุงุฑ `None` ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ ู ุฎุทุง ุซุจุช ูโฺฏุฑุฏุฏ. ุงู ฺฉุงุฑ ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ุชุง ุจู ุฑุงุญุช ุฎุทุงูุง ุฑุง ุดูุงุณุง ฺฉุฑุฏู ู ุขููุง ุฑุง ุจุฑุทุฑู ฺฉูุฏ.

**ฺฉุงุฑุจุฑุฏูุง:**

- **ููุชโฺฏุฐุงุฑ ุงุฎุชุงุฑ ูุนุงููู:** ูุฏู ุจูฺฉ-ุดููุฒ ุงุฒ ุญุฑฺฉุช ุจุฑุงูู ููุฏุณ ุจุฑุง ููุชโฺฏุฐุงุฑ ุงุฎุชุงุฑ ูุนุงููู ุงุณุชูุงุฏู ูโฺฉูุฏ.
- **ุดุจูโุณุงุฒ ูพุฑุชูู:** ุจุฑุง ุดุจูโุณุงุฒ ุจุงุฒุฏู ฺฉ ูพุฑุชูู ุณุฑูุงูโฺฏุฐุงุฑ ุงุฒ ุงู ูุฑููู ุงุณุชูุงุฏู ูโุดูุฏ.
- **ูุฏุฑุช ุฑุณฺฉ:** ุจุฑุง ุงุฑุฒุงุจ ุฑุณฺฉ ูุฑุชุจุท ุจุง ุณุฑูุงูโฺฏุฐุงุฑโูุง ุงุฒ ุงู ูุฑููู ุงุณุชูุงุฏู ูโุดูุฏ.

**ูฺฉุงุช ููู:**

- **ุงูุชุฎุงุจ ุชูุฒุน ููุงุณุจ ุจุฑุง ูุชุบุฑ ุชุตุงุฏู Z ุฏุฑ ูุฑููู ุญุฑฺฉุช ุจุฑุงูู ููุฏุณุ ุชุฃุซุฑ ุฒุงุฏ ุจุฑ ูุชุงุฌ ุดุจูโุณุงุฒ ุฏุงุฑุฏ.**
- **ููุณุงูโูพุฐุฑ ฺฉ ูพุงุฑุงูุชุฑ ฺฉูุฏ ุฏุฑ ูุฏูโุณุงุฒ ููุช ุฏุงุฑุงโูุง ุงุณุช ู ุจุฑ ูุฒุงู ููุณุงูุงุช ููุช ุชุฃุซุฑ ูโฺฏุฐุงุฑุฏ.**
- **ูุฏุฑุช ุฎุทุง ุฏุฑ ุดุจูโุณุงุฒ ุจุณุงุฑ ููู ุงุณุช ุชุง ุงุฒ ูุชุงุฌ ูุงุฏุฑุณุช ุฌููฺฏุฑ ุดูุฏ.**

### ๐ **ูุชุฏ `cornish_fisher_quantile`**

```python
def cornish_fisher_quantile(self, z: np.ndarray, skewness: float = 0.0, kurtosis_val: float = 3.0) -> np.ndarray:
    """
    ุชูุธู ฺฉูุงูุชุงูโูุง ูุฑูุงู ุงุณุชุงูุฏุงุฑุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุชูุณุนู ฺฉุฑููุด-ูุดุฑ.
    
    Args:
        z (np.ndarray): ฺฉูุงูุชุงูโูุง ูุฑูุงู ุงุณุชุงูุฏุงุฑุฏ.
        skewness (float): ฺููฺฏ ููุฑุฏ ูุธุฑ.
        kurtosis_val (float): ฺฉุดุฏฺฏ ููุฑุฏ ูุธุฑ.
    
    Returns:
        np.ndarray: ฺฉูุงูุชุงูโูุง ุชูุธูโุดุฏู.
    """
    excess_kurtosis = kurtosis_val - 3.0
    z_adj = (z +
             (z**2 - 1) * skewness / 6 +
             (z**3 - 3 * z) * excess_kurtosis / 24 -
             (2 * z**3 - 5 * z) * skewness**2 / 36)
    return z_adj
```

**ุชูุถุญุงุช:**

**ูุฑููู ุชูุฒุน ฺฉุฑููุด-ูุดุฑ:**

ูุฑููู:

z ุชุนุฏูโุดุฏู = z + ((zยฒ - 1) ร ฺููฺฏ) / 6 + ((zยณ - 3z) ร (ฺฉุดุฏฺฏ - 3)) / 24 - ((2zยณ - 5z) ร ฺููฺฏยฒ) / 36

**ุชูุณุฑ:**

ุงู ูุฑููู ฺฉ ุฑูุด ุจุฑุง ุชุจุฏู ฺฉ ูุชุบุฑ ุชุตุงุฏู ุจุง ุชูุฒุน ูุฑูุงู ุงุณุชุงูุฏุงุฑุฏ ุจู ฺฉ ูุชุบุฑ ุชุตุงุฏู ุจุง ุชูุฒุน ุฏูุฎูุงู ุจุง ฺููฺฏ ู ฺฉุดุฏฺฏ ูุดุฎุต ุงุณุช. ุจู ุนุจุงุฑุช ุฏฺฏุฑุ ุงู ูุฑููู ุจู ูุง ุงุฌุงุฒู ูโุฏูุฏ ุชุง ฺฉ ูุชุบุฑ ุชุตุงุฏู ุจุง ุชูุฒุน ูุฑูุงู ุฑุง ุทูุฑ ุชุบุฑ ุฏูู ฺฉู ุดฺฉู ุขู ุจู ุชูุฒุน ููุฑุฏ ูุธุฑ ูุง ูุฒุฏฺฉโุชุฑ ุดูุฏ.

- **z:** ฺฉูุงูุชุงูโูุง ุชูุฒุน ูุฑูุงู ุงุณุชุงูุฏุงุฑุฏ ูุณุชูุฏ. ุงู ููุงุฏุฑ ูุดุงู ูโุฏููุฏ ฺฉู ฺู ุฏุฑุตุฏ ุงุฒ ุฏุงุฏูโูุง ฺฉูุชุฑ ุงุฒ ฺฉ ููุฏุงุฑ ุฎุงุต ูุณุชูุฏ.
- **z ุชุนุฏูโุดุฏู:** ฺฉูุงูุชุงูโูุง ุชูุฒุน ุชุนุฏูโุดุฏู ูุณุชูุฏ ฺฉู ฺููฺฏ ู ฺฉุดุฏฺฏ ููุฑุฏ ูุธุฑ ุฑุง ุฏุงุฑูุฏ.
- **ฺฉุดุฏฺฏ (skewness):** ูุนุงุฑ ุจุฑุง ุงูุฏุงุฒูโฺฏุฑ ุนุฏู ุชูุงุฑู ฺฉ ุชูุฒุน ุงุณุช. ุงฺฏุฑ ฺููฺฏ ูุซุจุช ุจุงุดุฏุ ุฏู ุณูุช ุฑุงุณุช ุชูุฒุน ุจููุฏุชุฑ ุงุณุช ู ุงฺฏุฑ ฺููฺฏ ููู ุจุงุดุฏุ ุฏู ุณูุช ฺูพ ุจููุฏุชุฑ ุงุณุช.
- **ฺููฺฏ (kurtosis):** ูุนุงุฑ ุจุฑุง ุงูุฏุงุฒูโฺฏุฑ ุชุฒ ููู ู ูพููุง ุฏูโูุง ฺฉ ุชูุฒุน ุงุณุช. ุงฺฏุฑ ฺฉุดุฏฺฏ ุจุฒุฑฺฏุชุฑ ุงุฒ 3 ุจุงุดุฏุ ุชูุฒุน ูุณุจุช ุจู ุชูุฒุน ูุฑูุงู ููฺฉโุชุฒุชุฑ ู ุฏูโูุง ุจููุฏุชุฑ ุฏุงุฑุฏ.

**ฺฉุงุฑุจุฑุฏูุง:**

- **ุดุจูโุณุงุฒ ุฏุงุฏูโูุง:** ุจุฑุง ุงุฌุงุฏ ุฏุงุฏูโูุง ุดุจูโุณุงุฒ ุดุฏู ุจุง ุชูุฒุนโูุง ุฎุงุตุ ูโุชูุงู ุงุฒ ุงู ูุฑููู ุงุณุชูุงุฏู ฺฉุฑุฏ.
- **ุชุจุฏู ูุชุบุฑูุง ุชุตุงุฏู:** ุงฺฏุฑ ฺฉ ูุชุบุฑ ุชุตุงุฏู ุชูุฒุน ูุฑูุงู ูุฏุงุดุชู ุจุงุดุฏุ ูโุชูุงู ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ูุฑููู ุขู ุฑุง ุจู ฺฉ ูุชุบุฑ ุชุตุงุฏู ุจุง ุชูุฒุน ูุฒุฏฺฉ ุจู ูุฑูุงู ุชุจุฏู ฺฉุฑุฏ.
- **ุชุนู ููุฏุงุฑ ุจุญุฑุงู ุฏุฑ ุขุฒูููโูุง ุขูุงุฑ:** ุฏุฑ ุจุฑุฎ ุงุฒ ุขุฒูููโูุง ุขูุงุฑุ ูุงุฒ ุจู ุชุนู ููุฏุงุฑ ุจุญุฑุงู ุจุฑ ุงุณุงุณ ุชูุฒุนโูุง ุฎุงุต ุงุณุช ฺฉู ุงุฒ ุงู ูุฑููู ูโุชูุงู ุจุฑุง ูุญุงุณุจู ุขู ุงุณุชูุงุฏู ฺฉุฑุฏ.

**ูุญุฏูุฏุชโูุง:**

- **ุงู ูุฑููู ฺฉ ุชูุฑุจ ุงุณุช ู ููฺฉู ุงุณุช ุจุฑุง ุชูุฒุนโูุง ุจุง ฺููฺฏ ู ฺฉุดุฏฺฏ ุจุณุงุฑ ุฒุงุฏ ุฏูุช ฺฉุงู ูุฏุงุดุชู ุจุงุดุฏ.**
- **ุงู ูุฑููู ุจุฑุง ุชูุฒุนโูุง ฺฉู ุฏุงุฑุง ฺูุฏู ููู ูุณุชูุฏ ุง ุจุณุงุฑ ูพฺุฏู ูุณุชูุฏุ ููุงุณุจ ูุณุช.**

**ุจู ุทูุฑ ุฎูุงุตู:**

ูุฑููู ุชูุณุนู ฺฉุฑููุด-ูุดุฑ ฺฉ ุงุจุฒุงุฑ ูุฏุฑุชููุฏ ุจุฑุง ฺฉุงุฑ ุจุง ุชูุฒุนโูุง ุงุญุชูุงู ุงุณุช ู ุจู ูุง ุงุฌุงุฒู ูโุฏูุฏ ุชุง ุชูุฒุนโูุง ูพฺุฏูโุชุฑ ุฑุง ุจุฑ ุงุณุงุณ ุชูุฒุน ูุฑูุงู ุงุณุชุงูุฏุงุฑุฏ ูุฏูโุณุงุฒ ฺฉูู.

### ๐งฎ **ูุชุฏ `monte_carlo_simulation_worker`**

```python
def monte_carlo_simulation_worker(self, option_data: Dict[str, Any], num_simulations: int = 10000) -> Dict[str, Any]:
    """
    ุชุงุจุน ฺฉุงุฑฺฏุฑ ุจุฑุง ุดุจูโุณุงุฒ ูููุช ฺฉุงุฑูู. ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ multiprocessing.
    
    Args:
        option_data (Dict[str, Any]): ุฏฺฉุดูุฑ ุญุงู ุฏุงุฏูโูุง ุงุฎุชุงุฑ ูุนุงููู.
        num_simulations (int): ุชุนุฏุงุฏ ุดุจูโุณุงุฒโูุง.
    
    Returns:
        Dict[str, Any]: ูุชุงุฌ ุดุจูโุณุงุฒ ุจุฑุง ุงุฎุชุงุฑ ูุนุงููู.
    """
    try:
        # ุงุณุชุฎุฑุงุฌ ุฏุงุฏูโูุง ูุงุฒู
        S0 = option_data['last_spot_price']
        K = option_data['strike_price']
        option_type = option_data['option_type'].upper()
        T = option_data['days'] / 365
        r = self.risk_free_rate
        sigma = option_data['Volatility']
        premium_long = option_data['ask_price']
        premium_short = option_data['bid_price']
        contract_size = option_data['contract_size']
        option_name = option_data['option_name']
        ua_tse_code = option_data['ua_tse_code']

        # ุชุนู ฺููฺฏ ู ฺฉุดุฏฺฏ ุจุฑ ุงุณุงุณ ุณูุงุฑู ุจุงุฒุงุฑ ู ููุน ุงุฎุชุงุฑ ูุนุงููู
        market_view = self.market_views.get(option_name, 'neutral')
        skewness, kurtosis_val = self.get_skew_kurtosis(option_type, market_view)

        # ุดุจูโุณุงุฒ ููุช ุฏุงุฑุง
        Z = self.simulate_price(S0, K, r, sigma, T, num_simulations,
                                distribution_type=self.distribution_type,
                                skewness=skewness, kurtosis_val=kurtosis_val)
        if Z is None or len(Z) == 0:
            return {'option_name': option_name, 'pl_long': np.nan, 'pl_short': np.nan, 'S_T': np.nan}

        # ูุญุงุณุจู ูพุฑุฏุงุฎุชโูุง
        if option_type == 'CALL':
            payoff = np.maximum(Z - K, 0)
        elif option_type == 'PUT':
            payoff = np.maximum(K - Z, 0)
        else:
            payoff = np.nan
            logger.warning(f"ููุน ุงุฎุชุงุฑ ูุนุงููู {option_type} ุจุฑุง {option_name} ูพุดุชุจุงู ููโุดูุฏ.")

        # ูุญุงุณุจู ุณูุฏ/ุถุฑุฑ
        pl_long = (payoff - premium_long) * contract_size
        pl_short = (premium_short - payoff) * contract_size

        return {'option_name': option_name, 'pl_long': pl_long, 'pl_short': pl_short, 'S_T': Z}
    except Exception as e:
        logger.error(f"ุฎุทุง ุฏุฑ ุดุจูโุณุงุฒ ุจุฑุง {option_data.get('option_name', 'ูุงุดูุงุณ')}: {e}")
        return {'option_name': option_data.get('option_name', 'ูุงุดูุงุณ'), 'pl_long': None, 'pl_short': None, 'S_T': None}
```

**ุชูุถุญุงุช:**

- **ุงุณุชุฎุฑุงุฌ ุฏุงุฏูโูุง ุถุฑูุฑ**: ุดุงูู ููุช ุฏุงุฑุง ูพุงูุ ููุช ุงุฌุฑุง ุงุฎุชุงุฑ ูุนุงูููุ ููุน ุงุฎุชุงุฑ ูุนุงูููุ ุฒูุงู ุชุง ุณุฑุฑุณุฏุ ูุฑุฎ ุจูุฑู ุจุฏูู ุฑุณฺฉุ ููุณุงูุ ููุชโูุง ุฎุฑุฏ ู ูุฑูุดุ ุงูุฏุงุฒู ูุฑุงุฑุฏุงุฏ ู ูุงู ุงุฎุชุงุฑ ูุนุงููู.
  
- **ุชุนู ฺููฺฏ ู ฺฉุดุฏฺฏ**: ุจุฑ ุงุณุงุณ ุณูุงุฑู ุจุงุฒุงุฑ ู ููุน ุงุฎุชุงุฑ ูุนุงูููุ ฺููฺฏ ู ฺฉุดุฏฺฏ ููุงุณุจ ุชุนู ูโุดูุฏ.

**ูุญุงุณุจู ูพุฑุฏุงุฎุช (Payoff):**

ูพุฑุฏุงุฎุช ุฏุฑ ุงุฎุชุงุฑ ูุนุงูููุ ูุจูุบ ุงุณุช ฺฉู ุฏุฑ ุฒูุงู ุณุฑุฑุณุฏ ุงุฎุชุงุฑ ูุนุงููู ุจู ุฏุงุฑูุฏู ุขู ูพุฑุฏุงุฎุช ูโุดูุฏ. ุงู ููุฏุงุฑ ุจู ููุน ุงุฎุชุงุฑ ูุนุงููู (ุฎุฑุฏ ุง ูุฑูุด) ู ุฑุงุจุทู ุจู ููุช ุฏุงุฑุง ูพุงู ุฏุฑ ุฒูุงู ุณุฑุฑุณุฏ (S_T) ู ููุช ุงุฌุฑุง ุงุฎุชุงุฑ ูุนุงููู (K) ุจุณุชฺฏ ุฏุงุฑุฏ.

**ุงุฎุชุงุฑ ูุนุงููู ุฎุฑุฏ (Call):**

ูพุฑุฏุงุฎุช = ุญุฏุงฺฉุซุฑ(S_T - K, 0)

ุจู ุงู ูุนู ฺฉู ุงฺฏุฑ ููุช ุฏุงุฑุง ูพุงู ุฏุฑ ุฒูุงู ุณุฑุฑุณุฏ (S_T) ุจุดุชุฑ ุงุฒ ููุช ุงุฌุฑุง (K) ุจุงุดุฏุ ุฏุงุฑูุฏู ุงุฎุชุงุฑ ูโุชูุงูุฏ ุฏุงุฑุง ุฑุง ุจู ููุช ูพุงูโุชุฑ (K) ุจุฎุฑุฏ ู ุณูพุณ ุจุง ููุช ุจุงุฒุงุฑ (S_T) ุจูุฑูุดุฏ ู ุณูุฏ ฺฉูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุงุฎุชุงุฑ ูุนุงููู ุจโุงุฑุฒุด ูโุดูุฏ.

**ุงุฎุชุงุฑ ูุนุงููู ูุฑูุด (Put):**

ูพุฑุฏุงุฎุช = ุญุฏุงฺฉุซุฑ(K - S_T, 0)

ุจู ุงู ูุนู ฺฉู ุงฺฏุฑ ููุช ุฏุงุฑุง ูพุงู ุฏุฑ ุฒูุงู ุณุฑุฑุณุฏ (S_T) ฺฉูุชุฑ ุงุฒ ููุช ุงุฌุฑุง (K) ุจุงุดุฏุ ุฏุงุฑูุฏู ุงุฎุชุงุฑ ูโุชูุงูุฏ ุฏุงุฑุง ุฑุง ุจุง ููุช ุจุงุฒุงุฑ (S_T) ุจุฎุฑุฏ ู ุณูพุณ ุจู ููุช ุจุงูุงุชุฑ (K) ุจูุฑูุดุฏ ู ุณูุฏ ฺฉูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุงุฎุชุงุฑ ูุนุงููู ุจโุงุฑุฒุด ูโุดูุฏ.

**ูุญุงุณุจู ุณูุฏ/ุถุฑุฑ (Profit/Loss):**

- **ูููุนุช Long:**

  ุณูุฏ/ุถุฑุฑ = (ูพุฑุฏุงุฎุช - ูพุฑููู ุฎุฑุฏ) ร ุงูุฏุงุฒู ูุฑุงุฑุฏุงุฏ

  ุงู ูุฑููู ุณูุฏ ุง ุถุฑุฑ ฺฉู ฺฉ ูููุนุช ุฎุฑุฏ ุงุฎุชุงุฑ ูุนุงููู ุฑุง ูุดุงู ูโุฏูุฏ. ูพุฑุฏุงุฎุช ููุงูุทูุฑ ฺฉู ุฏุฑ ุจุงูุง ุชูุถุญ ุฏุงุฏู ุดุฏุ ูพุฑุฏุงุฎุช ููุง ุงุณุช ู ูพุฑููู ุฎุฑุฏ (Premium_Long) ูพุฑููู ุงุณุช ฺฉู ุฏุฑ ุงุจุชุฏุง ุจุฑุง ุฎุฑุฏ ุงุฎุชุงุฑ ูุนุงููู ูพุฑุฏุงุฎุช ุดุฏู ุงุณุช. ุงูุฏุงุฒู ูุฑุงุฑุฏุงุฏ ุจู ุชุนุฏุงุฏ ูุฑุงุฑุฏุงุฏูุง ุฎุฑุฏุงุฑ ุดุฏู ุงุดุงุฑู ุฏุงุฑุฏ.

- **ูููุนุช Short:**

  ุณูุฏ/ุถุฑุฑ = (ูพุฑููู ูุฑูุด - ูพุฑุฏุงุฎุช) ร ุงูุฏุงุฒู ูุฑุงุฑุฏุงุฏ

  ุงู ูุฑููู ุณูุฏ ุง ุถุฑุฑ ฺฉู ฺฉ ูููุนุช ูุฑูุด ุงุฎุชุงุฑ ูุนุงููู ุฑุง ูุดุงู ูโุฏูุฏ. ูพุฑููู ูุฑูุด (Premium_Short) ูพุฑููู ุงุณุช ฺฉู ุฏุฑ ุงุจุชุฏุง ุงุฒ ูุฑูุด ุงุฎุชุงุฑ ูุนุงููู ุฏุฑุงูุช ุดุฏู ุงุณุช.

**ูุฏุฑุช ุฎุทุง:**

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุฑฺฏููู ุฎุทุง ุฏุฑ ูุญุงุณุจุงุชุ ุจู ุฌุง ููุฏุงุฑ ุตุญุญุ ููุฏุงุฑ `NaN` (Not a Number) ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ ู ุฎุทุง ุซุจุช ูโฺฏุฑุฏุฏ. ุงู ฺฉุงุฑ ุจู ุดูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง ุฎุทุงูุง ุฑุง ุดูุงุณุง ู ุจุฑุทุฑู ฺฉูุฏ.

**ฺฉุงุฑุจุฑุฏูุง ุงู ูุฑูููโูุง:**

- **ุงุฑุฒุงุจ ุณูุฏ ู ุฒุงู:** ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ูุฑูููโูุง ูโุชูุงูุฏ ุณูุฏ ุง ุถุฑุฑ ุจุงูููู ฺฉ ูููุนุช ุงุฎุชุงุฑ ูุนุงููู ุฑุง ูุจู ุงุฒ ุงูุฌุงู ูุนุงููู ุชุฎูู ุจุฒูุฏ.
- **ุณุงุฎุช ุงุณุชุฑุงุชฺโูุง ูุนุงููุงุช:** ุงู ูุฑูููโูุง ูพุงู ู ุงุณุงุณ ุจุณุงุฑ ุงุฒ ุงุณุชุฑุงุชฺโูุง ูุนุงููุงุช ูุจุชู ุจุฑ ุงุฎุชุงุฑ ูุนุงููู ูุณุชูุฏ.
- **ูุฏูุณุงุฒ ููุชโฺฏุฐุงุฑ ุงุฎุชุงุฑ ูุนุงููู:** ุงู ูุฑูููโูุง ุฏุฑ ูุฏูโูุง ูพฺุฏูโุชุฑ ููุชโฺฏุฐุงุฑ ุงุฎุชุงุฑ ูุนุงููู ุงุณุชูุงุฏู ูโุดููุฏ.

**ูฺฉุงุช ููู:**

- **ูพุฑููู:** ูพุฑููู ููุช ุงุณุช ฺฉู ุจุฑุง ุฎุฑุฏ ุง ูุฑูุด ฺฉ ุงุฎุชุงุฑ ูุนุงููู ูพุฑุฏุงุฎุช ูโุดูุฏ.
- **ุงูุฏุงุฒู ูุฑุงุฑุฏุงุฏ:** ุงูุฏุงุฒู ูุฑุงุฑุฏุงุฏ ุจู ุชุนุฏุงุฏ ูุงุญุฏูุง ุฏุงุฑุง ูพุงู ฺฉู ูุฑ ูุฑุงุฑุฏุงุฏ ุงุฎุชุงุฑ ูุนุงููู ุจู ุขู ุงุดุงุฑู ุฏุงุฑุฏุ ฺฏูุชู ูโุดูุฏ.
- **ุนูุงูู ููุซุฑ ุจุฑ ูพุฑุฏุงุฎุช ู ุณูุฏ/ุถุฑุฑ:** ุนูุงูู ุจุฑ ููุช ุฏุงุฑุง ูพุงู ู ููุช ุงุฌุฑุงุ ุนูุงูุงุช ูุงููุฏ ููุณุงูโูพุฐุฑุ ูุฑุฎ ุจูุฑู ู ุฒูุงู ุชุง ุณุฑุฑุณุฏ ูุฒ ุจุฑ ูพุฑุฏุงุฎุช ู ุณูุฏ/ุถุฑุฑ ุงุฎุชุงุฑ ูุนุงููู ุชุฃุซุฑฺฏุฐุงุฑ ูุณุชูุฏ.

### ๐ญ **ูุชุฏ `monte_carlo_simulation`**

```python
def monte_carlo_simulation(self, num_simulations: int = 10000):
    """
    ุงุฌุฑุง ุดุจูโุณุงุฒโูุง ูููุช ฺฉุงุฑูู ุจุฑุง ุชูุงู ุงุฎุชุงุฑ ูุนุงูููโูุง.
    
    Args:
        num_simulations (int): ุชุนุฏุงุฏ ุดุจูโุณุงุฒโูุง ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู.
    """
    logger.info("ุดุฑูุน ุดุจูโุณุงุฒโูุง ูููุช ฺฉุงุฑูู.")
    pool = multiprocessing.Pool(processes=multiprocessing.cpu_count())
    func = partial(self.monte_carlo_simulation_worker, num_simulations=num_simulations)
    try:
        # ุชุจุฏู ูุฑ ุฑุฏู ุจู ุฏฺฉุดูุฑ ุจุฑุง ุงุฑุณุงู ุจู ฺฉุงุฑฺฏุฑ
        options_data = self.cleaned_data.to_dict(orient='records')
        results = pool.map(func, options_data)
    except Exception as e:
        logger.error(f"ุฎุทุง ุฏุฑ multiprocessing: {e}")
        pool.close()
        pool.join()
        raise
    pool.close()
    pool.join()

    for result in results:
        option_name = result['option_name']
        pl_long = result['pl_long']
        pl_short = result['pl_short']
        S_T = result['S_T']
        if isinstance(pl_long, np.ndarray) and isinstance(pl_short, np.ndarray) and isinstance(S_T, np.ndarray):
            self.simulation_results[option_name] = {'long': pl_long, 'short': pl_short}
            self.target_date_distribution[option_name] = S_T
            self.cash_flows[option_name] = {
                'long': {
                    'initial': -self.cleaned_data.loc[self.cleaned_data['option_name'] == option_name, 'ask_price'].values[0] *
                               self.cleaned_data.loc[self.cleaned_data['option_name'] == option_name, 'contract_size'].values[0],
                    'final': pl_long
                },
                'short': {
                    'initial': self.cleaned_data.loc[self.cleaned_data['option_name'] == option_name, 'bid_price'].values[0] *
                               self.cleaned_data.loc[self.cleaned_data['option_name'] == option_name, 'contract_size'].values[0],
                    'final': pl_short
                }
            }
        else:
            self.simulation_results[option_name] = {'long': np.nan, 'short': np.nan}
            self.target_date_distribution[option_name] = np.nan
            self.cash_flows[option_name] = {
                'long': {'initial': np.nan, 'final': np.nan},
                'short': {'initial': np.nan, 'final': np.nan}
            }
    logger.info("ุดุจูโุณุงุฒโูุง ูููุช ฺฉุงุฑูู ุชฺฉูู ุดุฏ.")
```

**ุชูุถุญุงุช:**

- **ุงุฌุฑุง ููุงุฒ ุดุจูโุณุงุฒโูุง:** ุจุง ุงุณุชูุงุฏู ุงุฒ `multiprocessing.Pool`, ุดุจูโุณุงุฒโูุง ุจูโุตูุฑุช ููุงุฒ ุจุฑุง ุชูุงู ุงุฎุชุงุฑ ูุนุงูููโูุง ุงุฌุฑุง ูโุดููุฏ.
- **ุฌูุนโุขูุฑ ูุชุงุฌ:** ูุชุงุฌ ุดุจูโุณุงุฒโูุง ุฏุฑ ูุชุบุฑูุง ุฏุงุฎู ุฐุฎุฑู ูโุดููุฏ.
- **ูุฏุฑุช ุฎุทุง:** ุฏุฑ ุตูุฑุช ุจุฑูุฒ ุฎุทุง ุฏุฑ multiprocessing, ูพุฑุฏุงุฒุดโูุง ุจูโุฏุฑุณุช ุฎุงุชูู ุงูุชู ู ุฎุทุง ุซุจุช ูโุดูุฏ.

---

### ๐ **ูุชุฏ `calculate_pop`**

```python
def calculate_pop(self):
    """
    ูุญุงุณุจู ุงุญุชูุงู ุณูุฏ (Probability of Profit) ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.
    """
    logger.info("ูุญุงุณุจู ุงุญุชูุงู ุณูุฏ (PoP) ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.")
    for option, results in self.simulation_results.items():
        pl_long = results.get('long', np.nan)
        pl_short = results.get('short', np.nan)
        pop_long = (np.sum(pl_long > 0) / len(pl_long)) * 100 if self.is_valid_array(pl_long) else np.nan
        pop_short = (np.sum(pl_short > 0) / len(pl_short)) * 100 if self.is_valid_array(pl_short) else np.nan
        self.pop_results[option] = {'long': pop_long, 'short': pop_short}
        logger.debug(f"PoP ุจุฑุง {option} - Long: {pop_long:.2f}%, Short: {pop_short:.2f}%")
```

**ุชูุถุญุงุช:**

**ุงุญุชูุงู ุณูุฏ (PoP):**

ุงุญุชูุงู ุณูุฏ (Probability of Profit ุง PoP) ุดุงุฎุต ุงุณุช ฺฉู ุฏุฑ ุชุญููโูุง ุดุจูโุณุงุฒ ูุนุงููุงุช ุจู ฺฉุงุฑ ูโุฑูุฏ ู ูุดุงู ูโุฏูุฏ ฺฉู ฺฉ ูุนุงููู ุง ุงุณุชุฑุงุชฺ ูุนุงููุงุช ุจุง ฺู ุงุญุชูุงู ุจู ุณูุฏ ุฎูุงูุฏ ุฑุณุฏ. ุงู ุดุงุฎุต ุจู ูุนุงูููโฺฏุฑุงู ฺฉูฺฉ ูโฺฉูุฏ ุชุง ูุจู ุงุฒ ุงุฌุฑุง ฺฉ ุงุณุชุฑุงุชฺ ุฏุฑ ุจุงุฒุงุฑ ูุงูุนุ ุงุฒ ุงุญุชูุงู ููููุช ุขู ุขฺฏุงู ุดููุฏ ู ุชุตููโฺฏุฑ ุจูุชุฑ ุฏุงุดุชู ุจุงุดูุฏ.

**ูุญุงุณุจู PoP:**

ุจุฑุง ูุญุงุณุจู PoPุ ุชุนุฏุงุฏ ุฏูุนุงุช ฺฉู ฺฉ ูุนุงููู ุฏุฑ ุดุจูโุณุงุฒโูุง ุจู ุณูุฏ ุฑุณุฏู ุงุณุช ุฑุง ุจุฑ ุชุนุฏุงุฏ ฺฉู ุดุจูโุณุงุฒโูุง ุชูุณู ฺฉุฑุฏู ู ุณูพุณ ูุชุฌู ุฑุง ุฏุฑ 100 ุถุฑุจ ูโฺฉูู ุชุง ุจู ุฏุฑุตุฏ ุชุจุฏู ุดูุฏ. ุจูโุทูุฑ ุฑุณูโุชุฑุ ูุฑููู ูุญุงุณุจู PoP ุจู ุตูุฑุช ุฒุฑ ุงุณุช:

PoP = (ุชุนุฏุงุฏ ุดุจูโุณุงุฒโูุง ุณูุฏุขูุฑ / ุชุนุฏุงุฏ ฺฉู ุดุจูโุณุงุฒโูุง) ร 100%

**ฺฉุงุฑุจุฑุฏูุง PoP:**

- **ุงุฑุฒุงุจ ุงุณุชุฑุงุชฺโูุง:** ุจุง ุงุณุชูุงุฏู ุงุฒ PoP ูโุชูุงู ุงุณุชุฑุงุชฺโูุง ูุฎุชูู ูุนุงููุงุช ุฑุง ุจุง ูู ููุงุณู ฺฉุฑุฏู ู ุงุณุชุฑุงุชฺโูุง ฺฉู ุจุดุชุฑู ุงุญุชูุงู ููููุช ุฑุง ุฏุงุฑูุฏุ ุงูุชุฎุงุจ ฺฉุฑุฏ.
- **ูุฏุฑุช ุฑุณฺฉ:** PoP ุจู ูุนุงูููโฺฏุฑุงู ฺฉูฺฉ ูโฺฉูุฏ ุชุง ุฑุณฺฉ ูุฑุชุจุท ุจุง ูุฑ ุงุณุชุฑุงุชฺ ุฑุง ุจูุชุฑ ุฏุฑฺฉ ฺฉุฑุฏู ู ุชุตููุงุช ุขฺฏุงูุงููโุชุฑ ุฏุฑ ููุฑุฏ ูุฏุฑุช ุฑุณฺฉ ุจฺฏุฑูุฏ.
- **ุจูููโุณุงุฒ ูพุงุฑุงูุชุฑูุง:** ูโุชูุงู ุงุฒ PoP ุจุฑุง ุชูุธู ู ุจูููโุณุงุฒ ูพุงุฑุงูุชุฑูุง ฺฉ ูุฏู ุง ุงุณุชุฑุงุชฺ ุงุณุชูุงุฏู ฺฉุฑุฏ ุชุง ุจู ุจุงูุงุชุฑู ุงุญุชูุงู ุณูุฏ ุฏุณุช ุงูุช.

### ๐ **ูุชุฏ `calculate_greeks`**

```python
def calculate_greeks(self):
    """
    ูุญุงุณุจู ุดุงุฎุตโูุง ููุงู (Greeks) ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู.
    """
    logger.info("ูุญุงุณุจู ุดุงุฎุตโูุง ููุงู (Greeks) ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู.")
    for idx, row in self.cleaned_data.iterrows():
        S0 = row['last_spot_price']
        K = row['strike_price']
        r = self.risk_free_rate
        sigma = row['Volatility']
        T = row['days'] / 365
        option_type = row['option_type'].upper()
        option_name = row['option_name']

        if S0 <= 0 ุง K <= 0 ุง sigma <= 0 ุง T <= 0:
            self.greeks[option_name] = {key: np.nan for key in
                                        ['Delta_long', 'Gamma_long', 'Theta_long', 'Vega_long', 'Rho_long',
                                         'Delta_short', 'Gamma_short', 'Theta_short', 'Vega_short', 'Rho_short']}
            logger.warning(f"ูพุงุฑุงูุชุฑูุง ูุงูุนุชุจุฑ ุจุฑุง ูุญุงุณุจู ุดุงุฎุตโูุง ููุงู ุจุฑุง {option_name}.")
            continue

        d1 = (np.log(S0 / K) + (r + 0.5 * sigma**2) * T) / (sigma * np.sqrt(T))
        d2 = d1 - sigma * np.sqrt(T)

        if option_type == 'CALL':
            delta_long = norm.cdf(d1)
            theta_long = (- (S0 * norm.pdf(d1) * sigma) / (2 * np.sqrt(T)) -
                          r * K * np.exp(-r * T) * norm.cdf(d2))
            rho_long = K * T * np.exp(-r * T) * norm.cdf(d2)
        elif option_type == 'PUT':
            delta_long = norm.cdf(d1) - 1
            theta_long = (- (S0 * norm.pdf(d1) * sigma) / (2 * np.sqrt(T)) +
                          r * K * np.exp(-r * T) * norm.cdf(-d2))
            rho_long = -K * T * np.exp(-r * T) * norm.cdf(-d2)
        else:
            delta_long = theta_long = rho_long = np.nan
            logger.warning(f"ููุน ุงุฎุชุงุฑ ูุนุงููู {option_type} ุจุฑุง {option_name} ูพุดุชุจุงู ููโุดูุฏ.")

        gamma_long = norm.pdf(d1) / (S0 * sigma * np.sqrt(T))
        vega_long = S0 * norm.pdf(d1) * np.sqrt(T)

        self.greeks[option_name] = {
            'Delta_long': delta_long,
            'Gamma_long': gamma_long,
            'Theta_long': theta_long,
            'Vega_long': vega_long,
            'Rho_long': rho_long,
            'Delta_short': -delta_long,
            'Gamma_short': -gamma_long,
            'Theta_short': -theta_long,
            'Vega_short': -vega_long,
            'Rho_short': -rho_long
        }
        logger.debug(f"ุดุงุฎุตโูุง ููุงู ุจุฑุง {option_name}: {self.greeks[option_name]}")
```

**ุชูุถุญุงุช:**

- **ุชุนุฑู ุดุงุฎุตโูุง ููุงู:**

  - **Delta (ฮ):** ุญุณุงุณุช ููุช ุงุฎุชุงุฑ ูุนุงููู ูุณุจุช ุจู ุชุบุฑุงุช ููุช ุฏุงุฑุง ูพุงู.
  
  - **Gamma (ฮ):** ุญุณุงุณุช Delta ูุณุจุช ุจู ุชุบุฑุงุช ููุช ุฏุงุฑุง ูพุงู.
  
  - **Theta (ฮ):** ุญุณุงุณุช ููุช ุงุฎุชุงุฑ ูุนุงููู ูุณุจุช ุจู ุชุบุฑุงุช ุฒูุงู ุจุงูโูุงูุฏู ุชุง ุณุฑุฑุณุฏ.
  
  - **Vega (V):** ุญุณุงุณุช ููุช ุงุฎุชุงุฑ ูุนุงููู ูุณุจุช ุจู ุชุบุฑุงุช ููุณุงู.
  
  - **Rho (ฯ):** ุญุณุงุณุช ููุช ุงุฎุชุงุฑ ูุนุงููู ูุณุจุช ุจู ุชุบุฑุงุช ูุฑุฎ ุจูุฑู ุจุฏูู ุฑุณฺฉ.

- **ูุฑูููโูุง ูุญุงุณุจู:**

  - **ุงุฎุชุงุฑ ูุนุงููู ุฎุฑุฏ (CALL):**

    - ฮ_L = N(d1)
    - ฮ_L = - (S0 * N'(d1) * ฯ) / (2 * โT) - r * K * e^{-rT} * N(d2)
    - ฯ_L = K * T * e^{-rT} * N(d2)

  - **ุงุฎุชุงุฑ ูุนุงููู ูุฑูุด (PUT):**

    - ฮ_L = N(d1) - 1
    - ฮ_L = - (S0 * N'(d1) * ฯ) / (2 * โT) + r * K * e^{-rT} * N(-d2)
    - ฯ_L = -K * T * e^{-rT} * N(-d2)

  - **Gamma ู Vega:**

    - ฮ_L = N'(d1) / (S0 * ฯ * โT)
    - V_L = S0 * N'(d1) * โT

**ูุฏุฑุช ุฎุทุง:**

ุฏุฑ ุตูุฑุช ุฏุงุดุชู ูพุงุฑุงูุชุฑูุง ูุงูุนุชุจุฑ ุง ููุน ุงุฎุชุงุฑ ูุนุงููู ูพุดุชุจุงูโูุดุฏูุ ููุงุฏุฑ `NaN` ุชูุธู ุดุฏู ู ูุดุฏุงุฑ ุซุจุช ูโุดูุฏ.

### ๐ **ูุชุฏ `calculate_breakeven`**

```python
def calculate_breakeven(self):
    """
    ูุญุงุณุจู ููุงุท ุณุฑ ุจู ุณุฑ ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.
    """
    logger.info("ูุญุงุณุจู ููุงุท ุณุฑ ุจู ุณุฑ ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.")
    for idx, row in self.cleaned_data.iterrows():
        option = row['option_name']
        option_type = row['option_type'].upper()
        S0 = row['last_spot_price']
        K = row['strike_price']
        premium_long = row['ask_price']
        premium_short = row['bid_price']
        r = self.risk_free_rate
        T = row['days'] / 365

        if option_type == 'CALL':
            breakeven_long = K + premium_long
            breakeven_short = K + premium_short
        elif option_type == 'PUT':
            breakeven_long = K - premium_long
            breakeven_short = K - premium_short
        else:
            breakeven_long = breakeven_short = np.nan
            logger.warning(f"ููุน ุงุฎุชุงุฑ ูุนุงููู {option_type} ุจุฑุง ูุญุงุณุจู ููุงุท ุณุฑ ุจู ุณุฑ ูพุดุชุจุงู ููโุดูุฏ.")

        adjusted_breakeven_long = breakeven_long * np.exp(r * T) if not np.isnan(breakeven_long) else np.nan
        adjusted_breakeven_short = breakeven_short * np.exp(r * T) if not np.isnan(breakeven_short) else np.nan

        breakeven_long_pct = ((adjusted_breakeven_long - S0) / S0) * 100 if not np.isnan(adjusted_breakeven_long) else np.nan
        breakeven_short_pct = ((adjusted_breakeven_short - S0) / S0) * 100 if not np.isnan(adjusted_breakeven_short) else np.nan

        self.breakeven_points[option] = {
            'long': adjusted_breakeven_long,
            'short': adjusted_breakeven_short,
            'long_pct': breakeven_long_pct,
            'short_pct': breakeven_short_pct
        }
        logger.debug(f"ููุงุท ุณุฑ ุจู ุณุฑ ุจุฑุง {option}: {self.breakeven_points[option]}")
```

**ุชูุถุญุงุช:**

- **ุชุนุฑู ููุงุท ุณุฑ ุจู ุณุฑ:**

  - **ุงุฎุชุงุฑ ูุนุงููู ุฎุฑุฏ (CALL):**

    ููุงุท ุณุฑ ุจู ุณุฑ ุจุฑุง ูููุนุช Long:
    
    ููุงุท ุณุฑ ุจู ุณุฑ = ููุช ุงุฌุฑุง + ูพุฑููู ุฎุฑุฏ

    ููุงุท ุณุฑ ุจู ุณุฑ ุจุฑุง ูููุนุช Short:
    
    ููุงุท ุณุฑ ุจู ุณุฑ = ููุช ุงุฌุฑุง + ูพุฑููู ูุฑูุด

  - **ุงุฎุชุงุฑ ูุนุงููู ูุฑูุด (PUT):**

    ููุงุท ุณุฑ ุจู ุณุฑ ุจุฑุง ูููุนุช Long:
    
    ููุงุท ุณุฑ ุจู ุณุฑ = ููุช ุงุฌุฑุง - ูพุฑููู ุฎุฑุฏ

    ููุงุท ุณุฑ ุจู ุณุฑ ุจุฑุง ูููุนุช Short:
    
    ููุงุท ุณุฑ ุจู ุณุฑ = ููุช ุงุฌุฑุง - ูพุฑููู ูุฑูุด

- **ุชูุธู ููุงุท ุณุฑ ุจู ุณุฑ ุจุฑ ุงุณุงุณ ูุฑุฎ ุจูุฑู:**

  ููุงุท ุณุฑ ุจู ุณุฑ ุชุนุฏูโุดุฏู = ููุงุท ุณุฑ ุจู ุณุฑ ร e^{rT}

- **ูุญุงุณุจู ุฏุฑุตุฏ ููุงุท ุณุฑ ุจู ุณุฑ ูุณุจุช ุจู ููุช ุฏุงุฑุง ูพุงู:**

  ุฏุฑุตุฏ ููุงุท ุณุฑ ุจู ุณุฑ = ((ููุงุท ุณุฑ ุจู ุณุฑ ุชุนุฏูโุดุฏู - ููุช ุฏุงุฑุง ูพุงู) / ููุช ุฏุงุฑุง ูพุงู) ร 100%

- **ูุฏุฑุช ุฎุทุง:**

  ุฏุฑ ุตูุฑุช ุฏุงุดุชู ููุน ุงุฎุชุงุฑ ูุนุงููู ูพุดุชุจุงูโูุดุฏูุ ููุงุฏุฑ `NaN` ุชูุธู ุดุฏู ู ูุดุฏุงุฑ ุซุจุช ูโุดูุฏ.

### ๐ **ูุชุฏ `calculate_sharpe_ratio`**

```python
def calculate_sharpe_ratio(self, risk_free_rate: float = 0.01):
    """
    ูุญุงุณุจู ูุณุจุช ุดุงุฑูพ ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.
    
    Args:
        risk_free_rate (float): ูุฑุฎ ุจูุฑู ุจุฏูู ุฑุณฺฉ ุจุฑุง ูุญุงุณุจู ูุณุจุช ุดุงุฑูพ.
    """
    logger.info("ูุญุงุณุจู ูุณุจุช ุดุงุฑูพ ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.")
    for option, positions in self.simulation_results.items():
        pl_long = positions.get('long', np.nan)
        pl_short = positions.get('short', np.nan)

        option_row = self.cleaned_data[self.cleaned_data['option_name'] == option]
        if option_row.empty:
            logger.warning(f"ุฏุงุฏูโุง ุจุฑุง ุงุฎุชุงุฑ ูุนุงููู {option} ุฏุฑ ูุญุงุณุจู ูุณุจุช ุดุงุฑูพ ุงูุช ูุดุฏ.")
            self.sharpe_ratios[option] = {'long': np.nan, 'short': np.nan}
            continue

        option_row = option_row.iloc[0]
        days_to_maturity = option_row['days']

        if self.is_valid_array(pl_long):
            initial_investment_long = option_row['ask_price'] * option_row['contract_size']
            if initial_investment_long > 0:
                returns_long = pl_long / initial_investment_long
                mean_return_long = np.mean(returns_long) * (365 / days_to_maturity)
                std_return_long = np.std(returns_long) * np.sqrt(365 / days_to_maturity)
                sharpe_long = (mean_return_long - risk_free_rate) / std_return_long if std_return_long > 0 else np.nan
            else:
                sharpe_long = np.nan
        else:
            sharpe_long = np.nan

        if self.is_valid_array(pl_short):
            initial_premium_short = option_row['bid_price'] * option_row['contract_size']
            if initial_premium_short > 0:
                returns_short = pl_short / initial_premium_short
                mean_return_short = np.mean(returns_short) * (365 / days_to_maturity)
                std_return_short = np.std(returns_short) * np.sqrt(365 / days_to_maturity)
                sharpe_short = (mean_return_short - risk_free_rate) / std_return_short if std_return_short > 0 else np.nan
            else:
                sharpe_short = np.nan
        else:
            sharpe_short = np.nan

        self.sharpe_ratios[option] = {'long': sharpe_long, 'short': sharpe_short}
        logger.debug(f"ูุณุจุช ุดุงุฑูพ ุจุฑุง {option}: {self.sharpe_ratios[option]}")
```

**ุชูุถุญุงุช:**

- **ุชุนุฑู ูุณุจุช ุดุงุฑูพ:**

  ูุณุจุช ุดุงุฑูพ = (ุจุงุฒุฏู ููุฑุฏ ุงูุชุธุงุฑ ุณุฑูุงูโฺฏุฐุงุฑ - ูุฑุฎ ุจูุฑู ุจุฏูู ุฑุณฺฉ) / ุงูุญุฑุงู ูุนุงุฑ ุจุงุฒุฏู ุณุฑูุงูโฺฏุฐุงุฑ

  ฺฉู ุฏุฑ ุขู:
  
  - **E[R_p]:** ุจุงุฒุฏู ููุฑุฏ ุงูุชุธุงุฑ ุณุฑูุงูโฺฏุฐุงุฑ.
  - **R_f:** ูุฑุฎ ุจูุฑู ุจุฏูู ุฑุณฺฉ.
  - **ฯ_p:** ุงูุญุฑุงู ูุนุงุฑ ุจุงุฒุฏู ุณุฑูุงูโฺฏุฐุงุฑ.

- **ูุญุงุณุจู ุจุงุฒุฏู ู ุงูุญุฑุงู ูุนุงุฑ:**

  ุจุฑุง **ูููุนุช Long** ู **Short** ุจูโุทูุฑ ุฌุฏุงฺฏุงูู ูุญุงุณุจู ูโุดูุฏ.

- **ูุฏุฑุช ุฎุทุง:**

  ุฏุฑ ุตูุฑุช ูุฏุงุดุชู ุฏุงุฏูโูุง ูุงุฒูุ ููุงุฏุฑ `NaN` ุชูุธู ุดุฏู ู ูุดุฏุงุฑ ุซุจุช ูโุดูุฏ.

### ๐ **ูุชุฏ `calculate_var_cvar`**

```python
def calculate_var_cvar(self, confidence_level: float = 0.95):
    """
    ูุญุงุณุจู Value at Risk (VaR) ู Conditional Value at Risk (CVaR) ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.
    
    Args:
        confidence_level (float): ุณุทุญ ุงุทููุงู ุจุฑุง ูุญุงุณุจู VaR ู CVaR.
    """
    logger.info(f"ูุญุงุณุจู VaR ู CVaR ุจุง ุณุทุญ ุงุทููุงู {confidence_level*100:.0f}%.")
    for option, positions in self.simulation_results.items():
        pl_long = positions.get('long', np.nan)
        pl_short = positions.get('short', np.nan)

        if self.is_valid_array(pl_long):
            var_long = np.percentile(pl_long, (1 - confidence_level) * 100)
            cvar_long = pl_long[pl_long <= var_long].mean()
        else:
            var_long = cvar_long = np.nan

        if self.is_valid_array(pl_short):
            var_short = np.percentile(pl_short, (1 - confidence_level) * 100)
            cvar_short = pl_short[pl_short <= var_short].mean()
        else:
            var_short = cvar_short = np.nan

        self.var[option] = {'long': var_long, 'short': var_short}
        self.cvar[option] = {'long': cvar_long, 'short': cvar_short}
        logger.debug(f"VaR ู CVaR ุจุฑุง {option}: VaR_Long={var_long}, CVaR_Long={cvar_long}, VaR_Short={var_short}, CVaR_Short={cvar_short}")
```

**ุชูุถุญุงุช:**

- **ุชุนุฑู VaR ู CVaR:**

  - **Value at Risk (VaR):** ุญุฏ ุถุฑุฑ ูุญุชูู ุฏุฑ ุณุทุญ ุงุทููุงู ูุดุฎุต.
    
    VaR = Percentile((1 - ฮฑ) ร 100)%

    ฺฉู ุฏุฑ ุขู ฮฑ ุณุทุญ ุงุทููุงู (ูุซูุงู นตูช) ุงุณุช.

  - **Conditional Value at Risk (CVaR):** ูุงูฺฏู ุถุฑุฑูุง ูุฑุงุชุฑ ุงุฒ VaR.
    
    CVaR = ูุงูฺฏู ุถุฑุฑูุง ฺฉู ุจุดุชุฑ ุงุฒ VaR ูุณุชูุฏ.

- **ูุญุงุณุจู VaR ู CVaR:**

  ุจุฑุง **ูููุนุช Long** ู **Short** ุจูโุทูุฑ ุฌุฏุงฺฏุงูู ูุญุงุณุจู ูโุดูุฏ.

- **ูุฏุฑุช ุฎุทุง:**

  ุฏุฑ ุตูุฑุช ูุฏุงุดุชู ุฏุงุฏูโูุง ูุงุฒูุ ููุงุฏุฑ `NaN` ุชูุธู ูโุดูุฏ.

### ๐ **ูุชุฏ `calculate_variance`**

```python
def calculate_variance(self):
    """
    ูุญุงุณุจู ูุงุฑุงูุณ ุณูุฏ ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.
    """
    logger.info("ูุญุงุณุจู ูุงุฑุงูุณ ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.")
    for option, positions in self.simulation_results.items():
        pl_long = positions.get('long', np.nan)
        pl_short = positions.get('short', np.nan)

        option_row = self.cleaned_data[self.cleaned_data['option_name'] == option]
        if option_row.empty:
            logger.warning(f"ุฏุงุฏูโุง ุจุฑุง ุงุฎุชุงุฑ ูุนุงููู {option} ุฏุฑ ูุญุงุณุจู ูุงุฑุงูุณ ุงูุช ูุดุฏ.")
            self.variance[option] = {'long': np.nan, 'short': np.nan}
            continue

        option_row = option_row.iloc[0]
        days_to_maturity = option_row['days']

        if self.is_valid_array(pl_long):
            variance_long = np.var(pl_long) * (252 / days_to_maturity)
        else:
            variance_long = np.nan

        if self.is_valid_array(pl_short):
            variance_short = np.var(pl_short) * (252 / days_to_maturity)
        else:
            variance_short = np.nan

        self.variance[option] = {'long': variance_long, 'short': variance_short}
        logger.debug(f"ูุงุฑุงูุณ ุจุฑุง {option}: ูุงุฑุงูุณ_Long={variance_long}, ูุงุฑุงูุณ_Short={variance_short}")
```

**ุชูุถุญุงุช:**

- **ุชุนุฑู ูุงุฑุงูุณ:**

  ูุงุฑุงูุณ = (252 / T) ร ูุงุฑุงูุณ ุณูุฏ

  ฺฉู ุฏุฑ ุขู T ุฒูุงู ุจุงูโูุงูุฏู ุชุง ุณุฑุฑุณุฏ ุจู ุฑูุฒ ุงุณุช.

- **ูุฏุฑุช ุฎุทุง:**

  ุฏุฑ ุตูุฑุช ูุฏุงุดุชู ุฏุงุฏูโูุง ูุงุฒูุ ููุงุฏุฑ `NaN` ุชูุธู ูโุดูุฏ.

### ๐ฐ **ูุชุฏ `calculate_payout_ratio`**

```python
def calculate_payout_ratio(self):
    """
    ูุญุงุณุจู ูุณุจุชโูุง ูพุฑุฏุงุฎุช ู ฺฉุงุฑุง ูพุฑููู ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.
    """
    logger.info("ูุญุงุณุจู ูุณุจุชโูุง ูพุฑุฏุงุฎุช ู ฺฉุงุฑุง ูพุฑููู ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ู ูููุนุช.")
    for option, cash_flows in self.cash_flows.items():
        option_row = self.cleaned_data[self.cleaned_data['option_name'] == option]
        if option_row.empty:
            logger.warning(f"ุฏุงุฏูโุง ุจุฑุง ุงุฎุชุงุฑ ูุนุงููู {option} ุฏุฑ ูุญุงุณุจู ูุณุจุช ูพุฑุฏุงุฎุช ุงูุช ูุดุฏ.")
            self.payout_ratios[option] = {
                'long': np.nan,
                'short': np.nan,
                'premium_efficiency_long': np.nan,
                'premium_efficiency_short': np.nan
            }
            continue

        option_row = option_row.iloc[0]
        contract_size = option_row['contract_size']
        premium_long = option_row['ask_price']
        premium_short = option_row['bid_price']
        pl_long = cash_flows['long']['final']
        pl_short = cash_flows['short']['final']

        if self.is_valid_array(pl_long):
            average_pl_long = np.mean(pl_long)
            initial_investment_long = premium_long * contract_size
            payout_long = average_pl_long / initial_investment_long if initial_investment_long > 0 else np.nan
            premium_efficiency_long = 1 / initial_investment_long if initial_investment_long > 0 else 0
        else:
            payout_long = premium_efficiency_long = np.nan

        if self.is_valid_array(pl_short):
            average_pl_short = np.mean(pl_short)
            initial_premium_short = premium_short * contract_size
            payout_short = average_pl_short / initial_premium_short if initial_premium_short > 0 else np.nan
            premium_efficiency_short = initial_premium_short
        else:
            payout_short = premium_efficiency_short = np.nan

        self.payout_ratios[option] = {
            'long': payout_long,
            'short': payout_short,
            'premium_efficiency_long': premium_efficiency_long,
            'premium_efficiency_short': premium_efficiency_short
        }
        logger.debug(f"ูุณุจุชโูุง ูพุฑุฏุงุฎุช ุจุฑุง {option}: {self.payout_ratios[option]}")
```

**ุชูุถุญุงุช:**

- **ุชุนุฑู ูุณุจุชโูุง ูพุฑุฏุงุฎุช:**

  - **ูููุนุช Long:**

    ูุณุจุช ูพุฑุฏุงุฎุช = ูุงูฺฏู ุณูุฏ/ุถุฑุฑ Long / ุณุฑูุงู ุงููู Long

    ฺฉุงุฑุง ูพุฑููู Long = 1 / ุณุฑูุงู ุงููู Long

  - **ูููุนุช Short:**

    ูุณุจุช ูพุฑุฏุงุฎุช = ูุงูฺฏู ุณูุฏ/ุถุฑุฑ Short / ูพุฑููู ุงููู Short

    ฺฉุงุฑุง ูพุฑููู Short = ูพุฑููู ุงููู Short

- **ูุฏุฑุช ุฎุทุง:**

  ุฏุฑ ุตูุฑุช ูุฏุงุดุชู ุฏุงุฏูโูุง ูุงุฒูุ ููุงุฏุฑ `NaN` ุชูุธู ูโุดูุฏ.

### ๐งญ **ูุชุฏ `determine_market_views`**

```python
def determine_market_views(self):
    """
    ุชุนู ุฏุฏฺฏุงู ุจุงุฒุงุฑ ุจุฑ ุงุณุงุณ ูููโููุณ ูุฑ ุงุฎุชุงุฑ ูุนุงููู.
    """
    logger.info("ุชุนู ุฏุฏฺฏุงู ุจุงุฒุงุฑ ุจุฑ ุงุณุงุณ ูููโููุณ.")
    for _, row in self.cleaned_data.iterrows():
        option = row['option_name']
        option_type = row['option_type'].upper()
        S = row['last_spot_price']
        K = row['strike_price']
        if option_type == 'CALL':
            self.market_views[option] = 'ุตุนูุฏ' if S > K else 'ูุฒูู'
        elif option_type == 'PUT':
            self.market_views[option] = 'ูุฒูู' if S < K else 'ุตุนูุฏ'
        else:
            self.market_views[option] = 'ุจโุทุฑู'
            logger.warning(f"ููุน ุงุฎุชุงุฑ ูุนุงููู {option_type} ุจุฑุง ุชุนู ุฏุฏฺฏุงู ุจุงุฒุงุฑ ูพุดุชุจุงู ููโุดูุฏ.")
```

**ุชูุถุญุงุช:**

- **ุชุนุฑู ุฏุฏฺฏุงู ุจุงุฒุงุฑ:**

  - **ุงุฎุชุงุฑ ูุนุงููู ุฎุฑุฏ (CALL):**

    ุฏุฏฺฏุงู ุจุงุฒุงุฑ = ุตุนูุฏ ุงฺฏุฑ ููุช ุฏุงุฑุง ูพุงู > ููุช ุงุฌุฑุงุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ูุฒูู

  - **ุงุฎุชุงุฑ ูุนุงููู ูุฑูุด (PUT):**

    ุฏุฏฺฏุงู ุจุงุฒุงุฑ = ูุฒูู ุงฺฏุฑ ููุช ุฏุงุฑุง ูพุงู < ููุช ุงุฌุฑุงุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ุตุนูุฏ

  ฺฉู ุฏุฑ ุขู \( S \) ููุช ุฏุงุฑุง ูพุงู ู \( K \) ููุช ุงุฌุฑุง ุงุฎุชุงุฑ ูุนุงููู ุงุณุช.

- **ูุฏุฑุช ุฎุทุง:**

  ุฏุฑ ุตูุฑุช ุฏุงุดุชู ููุน ุงุฎุชุงุฑ ูุนุงููู ูพุดุชุจุงูโูุดุฏูุ ุฏุฏฺฏุงู ุจุงุฒุงุฑ ุจูโุตูุฑุช `ุจโุทุฑู` ุชูุธู ุดุฏู ู ูุดุฏุงุฑ ุซุจุช ูโุดูุฏ.

### ๐ **ูุชุฏ `calculate_metrics_min_max`**

```python
def calculate_metrics_min_max(self):
    """
    ูุญุงุณุจู ุญุฏุงูู ู ุญุฏุงฺฉุซุฑ ููุงุฏุฑ ุดุงุฎุตโูุง ูุฎุชูู ุจุฑุง ูุฑ ูููุนุช ุฌูุช ุงุณุชุงูุฏุงุฑุฏุณุงุฒ.
    """
    metrics = ['sharpe_ratios', 'pop_results', 'var', 'cvar', 'payout_ratios', 'breakeven_pct', 'premium_efficiency']
    positions = ['long', 'short']
    for metric in metrics:
        self.metrics_min[metric] = {}
        self.metrics_max[metric] = {}
        for position in positions:
            if metric == 'sharpe_ratios':
                values = [self.sharpe_ratios.get(opt, {}).get(position, np.nan) for opt in self.cleaned_data['option_name']]
            elif metric == 'pop_results':
                values = [self.pop_results.get(opt, {}).get(position, np.nan) for opt in self.cleaned_data['option_name']]
            elif metric == 'payout_ratios':
                values = [self.payout_ratios.get(opt, {}).get(position, np.nan) for opt in self.cleaned_data['option_name']]
            elif metric == 'premium_efficiency':
                key = f'premium_efficiency_{position}'
                values = [self.payout_ratios.get(opt, {}).get(key, np.nan) for opt in self.cleaned_data['option_name']]
            elif metric == 'breakeven_pct':
                key = f'breakeven_{position}_pct'
                values = [self.breakeven_points.get(opt, {}).get(key, np.nan) for opt in self.cleaned_data['option_name']]
            elif metric == 'var':
                values = [self.var.get(opt, {}).get(position, np.nan) for opt in self.cleaned_data['option_name']]
            elif metric == 'cvar':
                values = [self.cvar.get(opt, {}).get(position, np.nan) for opt in self.cleaned_data['option_name']]
            else:
                values = []

            values = np.array(values)
            values = values[~np.isnan(values)]
            if len(values) > 0:
                self.metrics_min[metric][position] = np.min(values)
                self.metrics_max[metric][position] = np.max(values)
                logger.debug(f"ุดุงุฎุต '{metric}' ุจุฑุง ูููุนุช '{position}': min={self.metrics_min[metric][position]}, max={self.metrics_max[metric][position]}")
            else:
                self.metrics_min[metric][position] = 0
                self.metrics_max[metric][position] = 1
                logger.debug(f"ุดุงุฎุต '{metric}' ุจุฑุง ูููุนุช '{position}' ููุงุฏุฑ ูุนุชุจุฑ ูุฏุงุฑุฏ. ุชูุธู min=0 ู max=1.")
```

**ุชูุถุญุงุช:**

- **ูุญุงุณุจู ุญุฏุงูู ู ุญุฏุงฺฉุซุฑ ููุงุฏุฑ:**

  ุจุฑุง ูุฑ ุดุงุฎุต ู ูููุนุชุ ุญุฏุงูู ู ุญุฏุงฺฉุซุฑ ููุงุฏุฑ ุงุฒ ุฏุงุฏูโูุง ุดุจูโุณุงุฒโุดุฏู ุงุณุชุฎุฑุงุฌ ูโุดููุฏ ุชุง ุฏุฑ ูุฑุขูุฏ ุงุณุชุงูุฏุงุฑุฏุณุงุฒ ุงุณุชูุงุฏู ุดููุฏ.

- **ูุฏุฑุช ุฏุงุฏูโูุง ูุงูุต:**

  ุฏุฑ ุตูุฑุช ูุฏุงุดุชู ุฏุงุฏูโูุง ูุนุชุจุฑ ุจุฑุง ฺฉ ุดุงุฎุต ู ูููุนุชุ ุญุฏุงูู ู ุญุฏุงฺฉุซุฑ ุจูโุตูุฑุช ูพุดโูุฑุถ ุจุฑุงุจุฑ ุจุง ฐ ู ฑ ุชูุธู ูโุดููุฏ.

### ๐ **ูุชุฏ `standardize_metric`**

```python
def standardize_metric(self, value: float, metric_name: str, position: str) -> float:
    """
    ุงุณุชุงูุฏุงุฑุฏุณุงุฒ ููุฏุงุฑ ฺฉ ุดุงุฎุต ุจุฑ ุงุณุงุณ ุญุฏุงูู ู ุญุฏุงฺฉุซุฑ ุขู.
    
    Args:
        value (float): ููุฏุงุฑ ุดุงุฎุต ุจุฑุง ุงุณุชุงูุฏุงุฑุฏุณุงุฒ.
        metric_name (str): ูุงู ุดุงุฎุต.
        position (str): 'long' ุง 'short'.
    
    Returns:
        float: ููุฏุงุฑ ุงุณุชุงูุฏุงุฑุฏ ุดุฏู ุดุงุฎุต.
    """
    if metric_name in ['sharpe_ratios', 'pop_results', 'payout_ratios', 'premium_efficiency']:
        min_value = self.metrics_min[metric_name][position]
        max_value = self.metrics_max[metric_name][position]
        standardized = (value - min_value) / (max_value - min_value) if max_value != min_value else 0
    elif metric_name in ['var', 'cvar', 'breakeven_pct']:
        min_value = self.metrics_min[metric_name][position]
        max_value = self.metrics_max[metric_name][position]
        standardized = (max_value - value) / (max_value - min_value) if max_value != min_value else 0
    else:
        standardized = 0
        logger.warning(f"ุดูุงุฎุชู ูุดุฏู ุดุงุฎุต '{metric_name}' ุฏุฑ ููฺฏุงู ุงุณุชุงูุฏุงุฑุฏุณุงุฒ.")
    return standardized
```

**ุชูุถุญุงุช:**

- **ุงุณุชุงูุฏุงุฑุฏุณุงุฒ ุดุงุฎุตโูุง:**

  - **ุดุงุฎุตโูุง ูุซุจุช** (`sharpe_ratios`, `pop_results`, `payout_ratios`, `premium_efficiency`):

    ุงุณุชุงูุฏุงุฑุฏ ุดุฏู = (ููุฏุงุฑ - ุญุฏุงูู) / (ุญุฏุงฺฉุซุฑ - ุญุฏุงูู)

  - **ุดุงุฎุตโูุง ููู** (`var`, `cvar`, `breakeven_pct`):

    ุงุณุชุงูุฏุงุฑุฏ ุดุฏู = (ุญุฏุงฺฉุซุฑ - ููุฏุงุฑ) / (ุญุฏุงฺฉุซุฑ - ุญุฏุงูู)

- **ูุฏุฑุช ุฎุทุง:**

  ุฏุฑ ุตูุฑุช ุดูุงุณุง ูุดุฏู ุดุงุฎุตุ ููุฏุงุฑ ุงุณุชุงูุฏุงุฑุฏ ุดุฏู ุจูโุตูุฑุช ฐ ุชูุธู ุดุฏู ู ูุดุฏุงุฑ ุซุจุช ูโุดูุฏ.

### ๐ **ูุชุฏ `calculate_composite_score`**

```python
def calculate_composite_score(self, option: str, position: str) -> float:
    """
    ูุญุงุณุจู ุงูุชุงุฒ ุชุฑฺฉุจ ุจุฑุง ูููุนุช ฺฉ ุงุฎุชุงุฑ ูุนุงููู ุจุฑ ุงุณุงุณ ุดุงุฎุตโูุง ูุฎุชูู.
    
    Args:
        option (str): ูุงู ุงุฎุชุงุฑ ูุนุงููู.
        position (str): 'long' ุง 'short'.
    
    Returns:
        float: ุงูุชุงุฒ ุชุฑฺฉุจ.
    """
    metrics = ['sharpe_ratios', 'pop_results', 'var', 'cvar', 'payout_ratios', 'breakeven_pct', 'premium_efficiency']
    base_weights = {
        'sharpe_ratios': 0.10,
        'pop_results': 0.15,
        'var': 0.10,
        'cvar': 0.10,
        'payout_ratios': 0.15,
        'breakeven_pct': 0.25,
        'premium_efficiency': 0.15
    }
    adjusted_weights = base_weights.copy()
    if self.strategy == 'aggressive':
        adjusted_weights['payout_ratios'] += 0.05
        adjusted_weights['var'] -= 0.05
    elif self.strategy == 'conservative':
        adjusted_weights['var'] += 0.05
        adjusted_weights['payout_ratios'] -= 0.05

    # ูุฑูุงูโุณุงุฒ ูุฒูโูุง
    total_weight = sum(adjusted_weights.values())
    adjusted_weights = {k: v / total_weight for k, v in adjusted_weights.items()}

    score = 0
    for key in metrics:
        if key == 'premium_efficiency':
            value = self.payout_ratios.get(option, {}).get(f'premium_efficiency_{position}', np.nan)
        elif key == 'breakeven_pct':
            value = self.breakeven_points.get(option, {}).get(f'breakeven_{position}_pct', np.nan)
        else:
            metric_dict = getattr(self, key, {})
            value = metric_dict.get(option, {}).get(position, np.nan)

        if not np.isnan(value):
            standardized = self.standardize_metric(value, key, position)
            score += adjusted_weights[key] * standardized
            logger.debug(f"ุดุงุฎุต '{key}' ุจุฑุง {option} ูููุนุช {position}: ููุฏุงุฑ={value}, ุงุณุชุงูุฏุงุฑุฏ ุดุฏู={standardized}, ูุฒู={adjusted_weights[key]}, ุณูู ุงูุชุงุฒ={adjusted_weights[key] * standardized}")
        else:
            logger.debug(f"ุดุงุฎุต '{key}' ุจุฑุง {option} ูููุนุช {position} ูุงูุนุชุจุฑ ุงุณุช ู ุฏุฑ ูุญุงุณุจู ุงูุชุงุฒ ุชุฑฺฉุจ ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ.")

    logger.debug(f"ุงูุชุงุฒ ุชุฑฺฉุจ ุจุฑุง {option} ูููุนุช {position}: {score}")
    return score
```

**ุชูุถุญุงุช:**

- **ุชุนุฑู ูุฒูโูุง ูพุงู ู ุชูุธูโุดุฏู:**

  ูุฒูโูุง ุงููู ุดุงุฎุตโูุง ุจุฑ ุงุณุงุณ ุงุณุชุฑุงุชฺ (ุฎุดู ุง ูุญุงูุธูโฺฉุงุฑ) ุชูุธู ูโุดููุฏ.

  - **ุงุณุชุฑุงุชฺ ุฎุดู (Aggressive):**

    - ุงูุฒุงุด ูุฒู `payout_ratios` ุจู ูุฒุงู 0.05
    - ฺฉุงูุด ูุฒู `var` ุจู ูุฒุงู 0.05

  - **ุงุณุชุฑุงุชฺ ูุญุงูุธูโฺฉุงุฑ (Conservative):**

    - ุงูุฒุงุด ูุฒู `var` ุจู ูุฒุงู 0.05
    - ฺฉุงูุด ูุฒู `payout_ratios` ุจู ูุฒุงู 0.05

- **ูุฑูุงูโุณุงุฒ ูุฒูโูุง:**

  ูุฌููุน ูุฒูโูุง ุจุฑุงุจุฑ ุจุง ฑ ุชูุธู ูโุดูุฏ.

- **ูุญุงุณุจู ุงูุชุงุฒ ุชุฑฺฉุจ:**

  ูุฑ ุดุงุฎุต ุงุณุชุงูุฏุงุฑุฏุณุงุฒ ุดุฏู ุจุง ูุฒู ูุฑุจูุทู ุถุฑุจ ุดุฏู ู ุจู ุงูุชุงุฒ ฺฉู ุงุถุงูู ูโุดูุฏ.

- **ูุฏุฑุช ุฎุทุง:**

  ุฏุฑ ุตูุฑุช ูุงูุนุชุจุฑ ุจูุฏู ฺฉ ุดุงุฎุตุ ุขู ุดุงุฎุต ุฏุฑ ูุญุงุณุจู ุงูุชุงุฒ ุชุฑฺฉุจ ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ.

### ๐ **ูุชุฏ `compile_metrics_data`**

```python
def compile_metrics_data(self) -> pd.DataFrame:
    """
    ุฌูุนโุขูุฑ ุชูุงู ุดุงุฎุตโูุง ูุญุงุณุจูโุดุฏู ุฏุฑ ฺฉ DataFrame ุณุงุฎุชุงุฑุงูุชู.
    
    Returns:
        pd.DataFrame: DataFrame ุญุงู ุชูุงู ุดุงุฎุตโูุง ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู.
    """
    try:
        data = []
        for option in self.cleaned_data['option_name']:
            metrics = {
                'OptionName': option,
                'Sharpe_Long': self.sharpe_ratios.get(option, {}).get('long', np.nan),
                'Sharpe_Short': self.sharpe_ratios.get(option, {}).get('short', np.nan),
                'PoP_Long': self.pop_results.get(option, {}).get('long', np.nan),
                'PoP_Short': self.pop_results.get(option, {}).get('short', np.nan),
                'VaR_Long': self.var.get(option, {}).get('long', np.nan),
                'VaR_Short': self.var.get(option, {}).get('short', np.nan),
                'CVaR_Long': self.cvar.get(option, {}).get('long', np.nan),
                'CVaR_Short': self.cvar.get(option, {}).get('short', np.nan),
                'Breakeven_Long_Pct': self.breakeven_points.get(option, {}).get('long_pct', np.nan),
                'Breakeven_Short_Pct': self.breakeven_points.get(option, {}).get('short_pct', np.nan),
                'Premium_Efficiency_Long': self.payout_ratios.get(option, {}).get('premium_efficiency_long', np.nan),
                'Premium_Efficiency_Short': self.payout_ratios.get(option, {}).get('premium_efficiency_short', np.nan),
                'Variance_Long': self.variance.get(option, {}).get('long', np.nan),
                'Variance_Short': self.variance.get(option, {}).get('short', np.nan),
                # ุงูุฒูุฏู ุดุงุฎุตโูุง ุจุดุชุฑ ุฏุฑ ุตูุฑุช ูุงุฒ
            }
            data.append(metrics)
        metrics_df = pd.DataFrame(data)
        logger.info("ุฌูุนโุขูุฑ ุฏุงุฏูโูุง ุดุงุฎุตโูุง ุฏุฑ DataFrame ุชฺฉูู ุดุฏ.")
        return metrics_df
    except Exception as e:
        logger.error(f"ุฎุทุง ุฏุฑ ุฌูุนโุขูุฑ ุฏุงุฏูโูุง ุดุงุฎุตโูุง: {e}")
        return pd.DataFrame()
```

**ุชูุถุญุงุช:**

- **ุฌูุนโุขูุฑ ุดุงุฎุตโูุง:**

  ุชูุงู ุดุงุฎุตโูุง ูุญุงุณุจูโุดุฏู ุจุฑุง ูุฑ ุงุฎุชุงุฑ ูุนุงููู ุฏุฑ ฺฉ ุฏฺฉุดูุฑ ุฌูุนโุขูุฑ ู ุณูพุณ ุจู ฺฉ DataFrame ุชุจุฏู ูโุดููุฏ.

- **ูุฏุฑุช ุฎุทุง:**

  ุฏุฑ ุตูุฑุช ุจุฑูุฒ ุฎุทุงุ ุฎุทุง ุซุจุช ุดุฏู ู ฺฉ DataFrame ุฎุงู ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ.

---

## ๐ **ูุชุฌูโฺฏุฑ**

ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ูุฏููุ ุดูุง ูุงุฏุฑ ุจู ุชุญูู ุฏูู **ุงุฎุชุงุฑ ูุนุงูููโูุง** ุจุง ุจูุฑูโฺฏุฑ ุงุฒ ุฑูุดโูุง ุดุจูโุณุงุฒ ูพุดุฑูุชู ู ูุญุงุณุจู ุดุงุฎุตโูุง ูุงู ูุฎุชูู ุฎูุงูุฏ ุจูุฏ. ุงู ุงุจุฒุงุฑ ุงูฺฉุงูุงุช ุฒุฑ ุฑุง ูุฑุงูู ูโฺฉูุฏ:

1. **ุจุงุฑฺฏุฐุงุฑ ู ูพุฑุฏุงุฒุด ุฏุงุฏูโูุง:** ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉูุงุณ `DataLoader`, ุฏุงุฏูโูุง ุงููู ุจูโุตูุฑุช ุฏูู ุจุงุฑฺฏุฐุงุฑ ู ูพุฑุฏุงุฒุด ูโุดููุฏ.
2. **ุดุจูโุณุงุฒ ูููุช ฺฉุงุฑูู:** ุจุง ุงุณุชูุงุฏู ุงุฒ ุชูุฒุนโูุง ูุฎุชูู ู ุชูุธูุงุช ฺููฺฏ ู ฺฉุดุฏฺฏุ ุดุจูโุณุงุฒโูุง ูุชููุน ุงุฒ ููุชโูุง ุขูุฏู ุฏุงุฑุงโูุง ุงูุฌุงู ูโุดูุฏ.
3. **ูุญุงุณุจู ุดุงุฎุตโูุง ูุงู:** ุดุงุฎุตโูุง ูุงููุฏ ูุณุจุช ุดุงุฑูพุ PoPุ VaRุ CVaRุ ู ุดุงุฎุตโูุง ููุงู ุจุฑุง ุงุฑุฒุงุจ ุฑุณฺฉ ู ุจุงุฒุฏู ุงุฎุชุงุฑ ูุนุงูููโูุง ูุญุงุณุจู ูโุดููุฏ.
4. **ุชุญููโูุง ุชุนุงูู:** ุจุง ุงุณุชูุงุฏู ุงุฒ ุชุญููโูุง ุณูุงุฑู ู ุญุณุงุณุชุ ุชุฃุซุฑ ุชุบุฑุงุช ูุฎุชูู ุฏุฑ ุดุฑุงุท ุจุงุฒุงุฑ ู ูพุงุฑุงูุชุฑูุง ูุงู ุจุฑ ุนููฺฉุฑุฏ ุงุฎุชุงุฑ ูุนุงูููโูุง ุจุฑุฑุณ ูโุดูุฏ.
5. **ูุฏุฑุช ฺฉุงุฑุขูุฏ ูุฑุขูุฏ:** ุจุง ุจูุฑูโฺฏุฑ ุงุฒ ูพุฑุฏุงุฒุด ููุงุฒ (`multiprocessing`), ูุญุงุณุจุงุช ูพฺุฏู ุจูโุตูุฑุช ฺฉุงุฑุขูุฏ ู ุณุฑุน ุงูุฌุงู ูโุดููุฏ ุชุง ุฒูุงู ุงุฌุฑุง ฺฉุฏ ฺฉุงูุด ุงุจุฏ.
6. **ุซุจุช ุฏูู ูุงฺฏโูุง:** ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉุชุงุจุฎุงููโ `logging`, ุชูุงู ูุฑุงุญู ู ุฎุทุงูุง ุจูโุตูุฑุช ุฏูู ุซุจุช ุดุฏู ู ุงูฺฉุงู ูพฺฏุฑ ู ุฑูุน ูุดฺฉูุงุช ูุฑุงูู ุดุฏู ุงุณุช.


---

**ูพุงุงู**

ุงู ูุฏููุ ูุฑุงุชุฑ ุงุฒ ฺฉ ุงุจุฒุงุฑ ุชุญููุ ุชูุงุด ุงุณุช ุจุฑุง ุงุฑุงุฆูโ ุฏุฏฺฏุงู ููู ุฏุฑ ููุงุฌูู ุจุง ูพฺุฏฺฏโูุง ุฏูุง ุงุฎุชุงุฑ ูุนุงููู. ูุฑ ุฎุท ุงุฒ ฺฉุฏุ ูุฑ ูุฑููู ูุญุงุณุจุงุชุ ู ูุฑ ุดุจูโุณุงุฒ ุงูุฌุงูโุดุฏูุ ฺฏูุงู ุงุณุช ุจุฑ ุงุดุชุงู ุจโูพุงุงู ูู ุจุฑุง ุงุฌุงุฏ ุฑุงูโุญู ฺฉู ุฏุฑฺฉ ุฑุณฺฉ ู ุจุงุฒุฏู ุฑุง ุดูุงูโุชุฑ ฺฉูุฏ. ุงูุฏ ุฏุงุฑู ุงู ุงุซุฑุ ุจุฑุง ุชุญููโฺฏุฑุงู ูุงู ู ุนูุงููโููุฏุงู ุจู ุจุงุฒุงุฑ ุณุฑูุงูุ ููโุชููุง ุจูโุนููุงู ุงุจุฒุงุฑ ููุฏุ ุจูฺฉู ุจูโุนููุงู ุฏุนูุช ุจุฑุง ุฌุณุชโูุฌู ุฎูุงูุงููโุชุฑ ุฏุฑ ูุฑุฒูุง ุฏุงูุด ู ููุงูุฑุ ููุฑุฏ ุงุณุชูุจุงู ูุฑุงุฑ ฺฏุฑุฏ. ุขูุฏูุ ูุฏุงู ุจุงุฒ ูุงุณุชุ ุจุงุฏ ุขู ุฑุง ุจุง ุงุจุฒุงุฑูุง ุจูุชุฑ ู ูฺฏุงู ฺุฑูโุชุฑ ูุชุญ ฺฉูู.
